(function(e){"use strict";typeof define=="function"&&define.amd?define(["jquery"],e):typeof module!="undefined"&&module.exports?module.exports=e(require("jquery")):e(jQuery)})(function(e,t){"use strict";if(e.jstree)return;var g=0,i=!1,o=!1,r=!1,f=[],d=e("script:last").attr("src"),n=window.document,u,a,s,h,c,p,l=window.setImmediate,m=window.Promise;if(!l&&m&&(l=function(e,t){m.resolve(t).then(e)}),e.jstree={version:"3.3.12",defaults:{plugins:[]},plugins:{},path:d&&d.indexOf("/")!==-1?d.replace(/\/[^/]+$/,''):'',idregex:/[\\:&!^|()[\]<>@*'+~#";.,=\- /${}%?`]/g,root:"#"},e.jstree.create=function(o,t){var n=new e.jstree.core(++g),s=t;return t=e.extend(!0,{},e.jstree.defaults,t),s&&s.plugins&&(t.plugins=s.plugins),e.each(t.plugins,function(s,e){s!=="core"&&(n=n.plugin(e,t[e]))}),e(o).data("jstree",n),n.init(o,t),n},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(n).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1,ellipsis:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(n){var s=null,t=null;if(n&&n.id&&(!n.tagName||!n.nodeType)&&(n=n.id),!t||!t.length)try{t=e(n)}catch(e){}if(!t||!t.length)try{t=e("#"+n.replace(e.jstree.idregex,"\\$&"))}catch(e){}return t&&t.length&&(t=t.closest(".jstree")).length&&(t=t.data("jstree"))?s=t:e(".jstree").each(function(){var t=e(this).data("jstree");if(t&&t._model.data[n])return s=t,!1}),s},e.fn.jstree=function(n){var o=typeof n=="string",i=Array.prototype.slice.call(arguments,1),s=null;return!(n===!0&&!this.length)&&(this.each(function(){var a=e.jstree.reference(this),r=o&&a?a[n]:null;if(s=o&&r?r.apply(a,i):null,!a&&!o&&(n===t||e.isPlainObject(n))&&e.jstree.create(this,n),(a&&!o||n===!0)&&(s=a||!1),s!==null&&s!==t)return!1}),s!==null&&s!==t?s:this)},e.expr.pseudos.jstree=e.expr.createPseudo(function(){return function(n){return e(n).hasClass("jstree")&&e(n).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,ellipsis:!1,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0,loaded_state:!1,restore_focus:!0,compute_elements_positions:!1,keyboard:{'ctrl-space':function(t){t.type="click",e(t.currentTarget).trigger(t)},enter:function(t){t.type="click",e(t.currentTarget).trigger(t)},left:function(t){if(t.preventDefault(),this.is_open(t.currentTarget))this.close_node(t.currentTarget);else{var n=this.get_parent(t.currentTarget);n&&n.id!==e.jstree.root&&this.get_node(n,!0).children(".jstree-anchor").trigger("focus")}},up:function(t){t.preventDefault();var e=this.get_prev_dom(t.currentTarget);e&&e.length&&e.children(".jstree-anchor").trigger("focus")},right:function(t){if(t.preventDefault(),this.is_closed(t.currentTarget))this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").trigger("focus")});else if(this.is_open(t.currentTarget)){var n=this.get_node(t.currentTarget,!0).children(".jstree-children")[0];n&&e(this._firstChild(n)).children(".jstree-anchor").trigger("focus")}},down:function(t){t.preventDefault();var e=this.get_next_dom(t.currentTarget);e&&e.length&&e.children(".jstree-anchor").trigger("focus")},'*':function(){this.open_all()},home:function(n){n.preventDefault();var t=this._firstChild(this.get_container_ul()[0]);t&&e(t).children(".jstree-anchor").filter(":visible").trigger("focus")},end:function(e){e.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().trigger("focus")},f2:function(e){e.preventDefault(),this.edit(e.currentTarget)}}},e.jstree.core.prototype={plugin:function(n,s){var t=e.jstree.plugins[n];return t?(this._data[n]={},t.prototype=this,new t(s,this)):this},init:function(t,n){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=n,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl=this.element.css("direction")==="rtl",this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return this.nodeType===3&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='none'><i class='jstree-icon jstree-ocl'></i><"+"a class='jstree-anchor' role='treeitem' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().outerHeight()||24,this._data.core.node=this._create_prototype_node(),this.trigger("loading"),this.load_node(e.jstree.root)},destroy:function(e){if(this.trigger("destroy"),this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(e){}e||this.element.empty(),this.teardown()},_create_prototype_node:function(){var s=n.createElement("LI"),e,t;return s.setAttribute("role","none"),e=n.createElement("I"),e.className="jstree-icon jstree-ocl",e.setAttribute("role","presentation"),s.appendChild(e),e=n.createElement("A"),e.className="jstree-anchor",e.setAttribute("href","#"),e.setAttribute("tabindex","-1"),e.setAttribute("role","treeitem"),t=n.createElement("I"),t.className="jstree-icon jstree-themeicon",t.setAttribute("role","presentation"),e.appendChild(t),s.appendChild(e),e=t=null,s},_kbevent_to_func:function(n){var i={8:"Backspace",9:"Tab",13:"Enter",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9",'-13':"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock",16:"Shift",17:"Ctrl",18:"Alt",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*",173:"-"},o,s,t,e=[];if(n.ctrlKey&&e.push("ctrl"),n.altKey&&e.push("alt"),n.shiftKey&&e.push("shift"),e.push(i[n.which]||n.which),e=e.sort().join("-").toLowerCase(),e==="shift-shift"||e==="ctrl-ctrl"||e==="alt-alt")return null;o=this.settings.core.keyboard;for(s in o)if(o.hasOwnProperty(s))if(t=s,t!=="-"&&t!=="+"&&(t=t.replace("--","-MINUS").replace("+-","-MINUS").replace("++","-PLUS").replace("-+","-PLUS"),t=t.split(/-|\+/).sort().join("-").replace("MINUS","-").replace("PLUS","+").toLowerCase()),t===e)return o[s];return null},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,'')}),this.element=null},bind:function(){var t='',s=null,o=0;this.element.on("dblclick.jstree",function(e){if(e.target.tagName&&e.target.tagName.toLowerCase()==="input")return!0;if(n.selection&&n.selection.empty)n.selection.empty();else if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges(),t.collapse()}catch(e){}}}).on("mousedown.jstree",function(e){e.target===this.element[0]&&(e.preventDefault(),o=+new Date)}.bind(this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",function(e){this.toggle_node(e.target)}.bind(this)).on("dblclick.jstree",".jstree-anchor",function(e){if(e.target.tagName&&e.target.tagName.toLowerCase()==="input")return!0;this.settings.core.dblclick_toggle&&this.toggle_node(e.target)}.bind(this)).on("click.jstree",".jstree-anchor",function(t){t.preventDefault(),t.currentTarget!==n.activeElement&&e(t.currentTarget).trigger("focus"),this.activate_node(t.currentTarget,t)}.bind(this)).on("keydown.jstree",".jstree-anchor",function(e){if(e.target.tagName&&e.target.tagName.toLowerCase()==="input")return!0;this._data.core.rtl&&(e.which===37?e.which=39:e.which===39&&(e.which=37));var n=this._kbevent_to_func(e),t;if(n)if(t=n.call(this,e),t===!1||t===!0)return t}.bind(this)).on("load_node.jstree",function(n,t){t.status&&(t.node.id===e.jstree.root&&!this._data.core.loaded&&(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var n=[],t,s;for(t=0,s=this._data.core.selected.length;t<s;t++)n=n.concat(this._model.data[this._data.core.selected[t]].parents);n=e.vakata.array_unique(n);for(t=0,s=n.length;t<s;t++)this.open_node(n[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}}.bind(this),0))}.bind(this)).on("keypress.jstree",function(c){if(c.target.tagName&&c.target.tagName.toLowerCase()==="input")return!0;s&&clearTimeout(s),s=setTimeout(function(){t=''},500);var a=String.fromCharCode(c.which).toLowerCase(),i=this.element.find(".jstree-anchor").filter(":visible"),r=i.index(n.activeElement)||0,o=!1;if(t+=a,t.length>1){if(i.slice(r).each(function(s,n){if(e(n).text().toLowerCase().indexOf(t)===0)return e(n).trigger("focus"),o=!0,!1}.bind(this)),o)return;if(i.slice(0,r).each(function(s,n){if(e(n).text().toLowerCase().indexOf(t)===0)return e(n).trigger("focus"),o=!0,!1}.bind(this)),o)return}if(new RegExp("^"+a.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")+"+$").test(t)){if(i.slice(r+1).each(function(n,t){if(e(t).text().toLowerCase().charAt(0)===a)return e(t).trigger("focus"),o=!0,!1}.bind(this)),o)return;if(i.slice(0,r+1).each(function(n,t){if(e(t).text().toLowerCase().charAt(0)===a)return e(t).trigger("focus"),o=!0,!1}.bind(this)),o)return}}.bind(this)).on("init.jstree",function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this._data.core.themes.ellipsis=e.ellipsis,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)}.bind(this)).on("loading.jstree",function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"](),this[this._data.core.themes.ellipsis?"show_ellipsis":"hide_ellipsis"]()}.bind(this)).on("blur.jstree",".jstree-anchor",function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").trigger("mouseleave"),this.element.attr("tabindex","0")}.bind(this)).on("focus.jstree",".jstree-anchor",function(t){var n=this.get_node(t.currentTarget);n&&n.id&&(this._data.core.focused=n.id),this.element.find(".jstree-hovered").not(t.currentTarget).trigger("mouseleave"),e(t.currentTarget).trigger("mouseenter"),this.element.attr("tabindex","-1")}.bind(this)).on("focus.jstree",function(){if(+new Date-o>500&&!this._data.core.focused&&this.settings.core.restore_focus){o=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").trigger("focus")}}.bind(this)).on("mouseenter.jstree",".jstree-anchor",function(e){this.hover_node(e.currentTarget)}.bind(this)).on("mouseleave.jstree",".jstree-anchor",function(e){this.dehover_node(e.currentTarget)}.bind(this))},unbind:function(){this.element.off(".jstree"),e(n).off(".jstree-"+this._id)},trigger:function(t,e){e||(e={}),e.instance=this,this.element.triggerHandler(t.replace(".jstree",'')+".jstree",e)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(n){var t=this.settings.core.strings;return e.vakata.is_function(t)?t.call(this,n):t&&t[n]?t[n]:n},_firstChild:function(e){for(e=e?e.firstChild:null;e!==null&&e.nodeType!==1;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;e!==null&&e.nodeType!==1;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;e!==null&&e.nodeType!==1;)e=e.previousSibling;return e},get_node:function(t,s){t&&t.id&&(t=t.id),t instanceof e&&t.length&&t[0].id&&(t=t[0].id);var n;try{if(this._model.data[t])t=this._model.data[t];else if(typeof t=="string"&&this._model.data[t.replace(/^#/,'')])t=this._model.data[t.replace(/^#/,'')];else if(typeof t=="string"&&(n=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[n.closest(".jstree-node").attr("id")])t=this._model.data[n.closest(".jstree-node").attr("id")];else if((n=this.element.find(t)).length&&this._model.data[n.closest(".jstree-node").attr("id")])t=this._model.data[n.closest(".jstree-node").attr("id")];else if((n=this.element.find(t)).length&&n.hasClass("jstree"))t=this._model.data[e.jstree.root];else return!1;return s&&(t=t.id===e.jstree.root?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(e){return!1}},get_path:function(t,o,i){if(t=t.parents?t:this.get_node(t),!t||t.id===e.jstree.root||!t.parents)return!1;var s,a,n=[];n.push(i?t.id:t.text);for(s=0,a=t.parents.length;s<a;s++)n.push(i?t.parents[s]:this.get_text(t.parents[s]));return n=n.reverse().slice(1),o?n.join(o):n},get_next_dom:function(n,s){if(n=this.get_node(n,!0),n[0]===this.element[0]){t=this._firstChild(this.get_container_ul()[0]);for(var t;t&&t.offsetHeight===0;)t=this._nextSibling(t);return!!t&&e(t)}if(!n||!n.length)return!1;if(s){t=n[0];do t=this._nextSibling(t);while(t&&t.offsetHeight===0)return!!t&&e(t)}if(n.hasClass("jstree-open")){for(t=this._firstChild(n.children(".jstree-children")[0]);t&&t.offsetHeight===0;)t=this._nextSibling(t);if(t!==null)return e(t)}t=n[0];do t=this._nextSibling(t);while(t&&t.offsetHeight===0)return t!==null?e(t):n.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(n,s){if(n=this.get_node(n,!0),n[0]===this.element[0]){t=this.get_container_ul()[0].lastChild;for(var t;t&&t.offsetHeight===0;)t=this._previousSibling(t);return!!t&&e(t)}if(!n||!n.length)return!1;if(s){t=n[0];do t=this._previousSibling(t);while(t&&t.offsetHeight===0)return!!t&&e(t)}t=n[0];do t=this._previousSibling(t);while(t&&t.offsetHeight===0)if(t!==null){for(n=e(t);n.hasClass("jstree-open");)n=n.children(".jstree-children").first().children(".jstree-node:visible:last");return n}return t=n[0].parentNode.parentNode,!!(t&&t.className&&t.className.indexOf("jstree-node")!==-1)&&e(t)},get_parent:function(t){return!(t=this.get_node(t),!t||t.id===e.jstree.root)&&t.parent},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return e=this.get_node(e),e&&(e.state.loaded===!1||e.children.length>0)},is_loaded:function(e){return e=this.get_node(e),e&&e.state.loaded},is_loading:function(e){return e=this.get_node(e),e&&e.state&&e.state.loading},is_open:function(e){return e=this.get_node(e),e&&e.state.opened},is_closed:function(e){return e=this.get_node(e),e&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,n){var s,a,o,r,i;if(e.vakata.is_array(t))return this._load_nodes(t.slice(),n),!0;if(t=this.get_node(t),!t)return n&&n.call(this,t,!1),!1;if(t.state.loaded){t.state.loaded=!1;for(o=0,r=t.parents.length;o<r;o++)this._model.data[t.parents[o]].children_d=e.vakata.array_filter(this._model.data[t.parents[o]].children_d,function(n){return e.inArray(n,t.children_d)===-1});for(s=0,a=t.children_d.length;s<a;s++)this._model.data[t.children_d[s]].state.selected&&(i=!0),delete this._model.data[t.children_d[s]];i&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(n){return e.inArray(n,t.children_d)===-1})),t.children=[],t.children_d=[],i&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,function(o){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=o,t.state.failed=!t.state.loaded;var e=this.get_node(t,!0),s=0,i=0,a=this._model.data,r=!1;for(s=0,i=t.children.length;s<i;s++)if(a[t.children[s]]&&!a[t.children[s]].state.hidden){r=!0;break}t.state.loaded&&e&&e.length&&(e.removeClass("jstree-closed jstree-open jstree-leaf"),r?t.id!=="#"&&e.addClass(t.state.opened?"jstree-open":"jstree-closed"):e.addClass("jstree-leaf")),e.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:o}),n&&n.call(this,t,o)}.bind(this)),!0},_load_nodes:function(t,s,c,l){var a=!0,r=function(){this._load_nodes(t,s,!0)},n=this._model.data,e,o,i=[];for(e=0,o=t.length;e<o;e++)n[t[e]]&&(!n[t[e]].state.loaded&&!n[t[e]].state.failed||!c&&l)&&(this.is_loading(t[e])||this.load_node(t[e],r),a=!1);if(a){for(e=0,o=t.length;e<o;e++)n[t[e]]&&n[t[e]].state.loaded&&i.push(t[e]);s&&!s.done&&(s.call(this,i),s.done=!0)}},load_all:function(t,a){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var o=[],i=this._model.data,s=i[t.id].children_d,n,r;t.state&&!t.state.loaded&&o.push(t.id);for(n=0,r=s.length;n<r;n++)i[s[n]]&&i[s[n]].state&&!i[s[n]].state.loaded&&o.push(s[n]);o.length?this._load_nodes(o,function(){this.load_all(t,a)}):(a&&a.call(this,t),this.trigger("load_all",{node:t}))},_load_node:function(n,s){var t=this.settings.core.data,o,i=function(){return this.nodeType!==3&&this.nodeType!==8};return t?e.vakata.is_function(t)?t.call(this,n,function(t){t===!1?s.call(this,!1):this[typeof t=="string"?"_append_html_data":"_append_json_data"](n,typeof t=="string"?e(e.parseHTML(t)).filter(i):t,function(e){s.call(this,e)})}.bind(this)):typeof t=="object"?t.url?(t=e.extend(!0,{},t),e.vakata.is_function(t.url)&&(t.url=t.url.call(this,n)),e.vakata.is_function(t.data)&&(t.data=t.data.call(this,n)),e.ajax(t).done(function(t,r,a){var o=a.getResponseHeader("Content-Type");return o&&o.indexOf("json")!==-1||typeof t=="object"?this._append_json_data(n,t,function(e){s.call(this,e)}):o&&o.indexOf("html")!==-1||typeof t=="string"?this._append_html_data(n,e(e.parseHTML(t)).filter(i),function(e){s.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:n.id,xhr:a})},this.settings.core.error.call(this,this._data.core.last_error),s.call(this,!1))}.bind(this)).fail(function(e){this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:n.id,xhr:e})},s.call(this,!1),this.settings.core.error.call(this,this._data.core.last_error)}.bind(this))):(e.vakata.is_array(t)?o=e.extend(!0,[],t):e.isPlainObject(t)?o=e.extend(!0,{},t):o=t,n.id===e.jstree.root)?this._append_json_data(n,o,function(e){s.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:n.id})},this.settings.core.error.call(this,this._data.core.last_error),s.call(this,!1)):typeof t=="string"?n.id===e.jstree.root?this._append_html_data(n,e(e.parseHTML(t)).filter(i),function(e){s.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:n.id})},this.settings.core.error.call(this,this._data.core.last_error),s.call(this,!1)):s.call(this,!1):n.id===e.jstree.root?this._append_html_data(n,this._data.core.original_container_html.clone(!0),function(e){s.call(this,e)}):s.call(this,!1)},_node_changed:function(t){t=this.get_node(t),t&&e.inArray(t.id,this._model.changed)===-1&&this._model.changed.push(t.id)},_append_html_data:function(r,c,m){r=this.get_node(r),r.children=[],r.children_d=[];var u=c.is("ul")?c.children():c,i=r.id,l=[],t=[],a=this._model.data,s=a[i],h=this._data.core.selected.length,n,o,d;u.each(function(r,o){n=this._parse_model_from_html(e(o),i,s.parents.concat()),n&&(l.push(n),t.push(n),a[n].children_d.length&&(t=t.concat(a[n].children_d)))}.bind(this)),s.children=l,s.children_d=t;for(o=0,d=s.parents.length;o<d;o++)a[s.parents[o]].children_d=a[s.parents[o]].children_d.concat(t);this.trigger("model",{nodes:t,parent:i}),i!==e.jstree.root?(this._node_changed(i),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==h&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),m.call(this,!0)},_append_json_data:function(s,t,a,d){if(this.element===null)return;s=this.get_node(s),s.children=[],s.children_d=[],t.d&&(t=t.d,typeof t=="string"&&(t=JSON.parse(t))),e.vakata.is_array(t)||(t=[t]);var o=null,i={df:this._model.default_state,dat:t,par:s.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},n=this,r=function(r,d){r.data&&(r=r.data);var s=r.dat,u=r.par,g=[],a=[],m=[],l=r.df,j=r.t_id,f=r.t_cnt,t=r.m,o=t[u],p=r.sel,c,e,i,h,v=function(e,i,o){o?o=o.concat():o=[],i&&o.unshift(i);var c=e.id.toString(),s,u,a,r,n={id:c,text:e.text||'',icon:e.icon===d||e.icon,parent:i,parents:o,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in l)l.hasOwnProperty(s)&&(n.state[s]=l[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(n.icon=e.data.jstree.icon),(n.icon===d||n.icon===null||n.icon==="")&&(n.icon=!0),e&&e.data)if(n.data=e.data,e.data.jstree)for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(n.state[s]=e.data.jstree[s]);if(e&&typeof e.state=="object")for(s in e.state)e.state.hasOwnProperty(s)&&(n.state[s]=e.state[s]);if(e&&typeof e.li_attr=="object")for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(n.li_attr[s]=e.li_attr[s]);if(n.li_attr.id||(n.li_attr.id=c),e&&typeof e.a_attr=="object")for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(n.a_attr[s]=e.a_attr[s]);e&&e.children&&e.children===!0&&(n.state.loaded=!1,n.children=[],n.children_d=[]),t[n.id]=n;for(s=0,u=n.children.length;s<u;s++)a=v(t[n.children[s]],n.id,o),r=t[a],n.children_d.push(a),r.children_d.length&&(n.children_d=n.children_d.concat(r.children_d));return delete e.data,delete e.children,t[n.id].original=e,n.state.selected&&m.push(n.id),n.id},b=function(e,i,o){o?o=o.concat():o=[],i&&o.unshift(i);var a=!1,s,u,r,c,n;do a="j"+j+"_"+ ++f;while(t[a])n={id:!1,text:typeof e=="string"?e:'',icon:!(typeof e=="object"&&e.icon!==d)||e.icon,parent:i,parents:o,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in l)l.hasOwnProperty(s)&&(n.state[s]=l[s]);if(e&&e.id&&(n.id=e.id.toString()),e&&e.text&&(n.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(n.icon=e.data.jstree.icon),(n.icon===d||n.icon===null||n.icon==="")&&(n.icon=!0),e&&e.data)if(n.data=e.data,e.data.jstree)for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(n.state[s]=e.data.jstree[s]);if(e&&typeof e.state=="object")for(s in e.state)e.state.hasOwnProperty(s)&&(n.state[s]=e.state[s]);if(e&&typeof e.li_attr=="object")for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(n.li_attr[s]=e.li_attr[s]);if(n.li_attr.id&&!n.id&&(n.id=n.li_attr.id.toString()),n.id||(n.id=a),n.li_attr.id||(n.li_attr.id=n.id),e&&typeof e.a_attr=="object")for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(n.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,u=e.children.length;s<u;s++)r=b(e.children[s],n.id,o),c=t[r],n.children.push(r),c.children_d.length&&(n.children_d=n.children_d.concat(c.children_d));n.children_d=n.children_d.concat(n.children)}return e&&e.children&&e.children===!0&&(n.state.loaded=!1,n.children=[],n.children_d=[]),delete e.data,delete e.children,n.original=e,t[n.id]=n,n.state.selected&&m.push(n.id),n.id};if(s.length&&s[0].id!==d&&s[0].parent!==d){for(e=0,i=s.length;e<i;e++)s[e].children||(s[e].children=[]),s[e].state||(s[e].state={}),t[s[e].id.toString()]=s[e];for(e=0,i=s.length;e<i;e++){if(!t[s[e].parent.toString()]){typeof n!="undefined"&&(n._data.core.last_error={error:"parse",plugin:"core",id:"core_07",reason:"Node with invalid parent",data:JSON.stringify({id:s[e].id.toString(),parent:s[e].parent.toString()})},n.settings.core.error.call(n,n._data.core.last_error));continue}t[s[e].parent.toString()].children.push(s[e].id.toString()),o.children_d.push(s[e].id.toString())}for(e=0,i=o.children.length;e<i;e++)c=v(t[o.children[e]],u,o.parents.concat()),a.push(c),t[c].children_d.length&&(a=a.concat(t[c].children_d));for(e=0,i=o.parents.length;e<i;e++)t[o.parents[e]].children_d=t[o.parents[e]].children_d.concat(a);h={cnt:f,mod:t,sel:p,par:u,dpc:a,add:m}}else{for(e=0,i=s.length;e<i;e++)c=b(s[e],u,o.parents.concat()),c&&(g.push(c),a.push(c),t[c].children_d.length&&(a=a.concat(t[c].children_d)));o.children=g,o.children_d=a;for(e=0,i=o.parents.length;e<i;e++)t[o.parents[e]].children_d=t[o.parents[e]].children_d.concat(a);h={cnt:f,mod:t,sel:p,par:u,dpc:a,add:m}}if(typeof window=="undefined"||typeof window.document=="undefined")postMessage(h);else return h},c=function(s,d){if(this.element===null)return;this._cnt=s.cnt,i=this._model.data;for(t in i)i.hasOwnProperty(t)&&i[t].state&&i[t].state.loading&&s.mod[t]&&(s.mod[t].state.loading=!0);if(this._model.data=s.mod,d){var t,i,c,u=s.add,o=s.sel,r=this._data.core.selected.slice();if(i=this._model.data,o.length!==r.length||e.vakata.array_unique(o.concat(r)).length!==o.length){for(t=0,c=o.length;t<c;t++)e.inArray(o[t],u)===-1&&e.inArray(o[t],r)===-1&&(i[o[t]].state.selected=!1);for(t=0,c=r.length;t<c;t++)e.inArray(r[t],o)===-1&&(i[r[t]].state.selected=!0)}}s.add.length&&(this._data.core.selected=this._data.core.selected.concat(s.add)),this.trigger("model",{nodes:s.dpc,parent:s.par}),s.par!==e.jstree.root?(this._node_changed(s.par),this.redraw()):this.redraw(!0),s.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),!d&&l?l(function(){a.call(n,!0)}):a.call(n,!0)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{this._wrk===null&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+r.toString()],{type:"text/javascript"}))),!this._data.core.working||d?(this._data.core.working=!0,o=new window.Worker(this._wrk),o.onmessage=function(e){c.call(this,e.data,!0);try{o.terminate(),o=null}catch(e){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}.bind(this),i.par?o.postMessage(i):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([s,t,a,!0])}catch(e){c.call(this,r(i),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else c.call(this,r(i),!1)},_parse_model_from_html:function(o,l,a){a?a=[].concat(a):a=[],l&&a.unshift(l);var r,c,u=this._model.data,n={id:!1,text:!1,icon:!0,parent:l,parents:a,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},i,s,d;for(i in this._model.default_state)this._model.default_state.hasOwnProperty(i)&&(n.state[i]=this._model.default_state[i]);if(s=e.vakata.attributes(o,!0),e.each(s,function(s,t){if(t=e.vakata.trim(t),!t.length)return!0;n.li_attr[s]=t,s==="id"&&(n.id=t.toString())}),s=o.children("a").first(),s.length&&(s=e.vakata.attributes(s,!0),e.each(s,function(s,t){t=e.vakata.trim(t),t.length&&(n.a_attr[s]=t)})),s=o.children("a").first().length?o.children("a").first().clone():o.clone(),s.children("ins, i, ul").remove(),s=s.html(),s=e("<div></div>").html(s),n.text=this.settings.core.force_text?s.text():s.html(),s=o.data(),n.data=s?e.extend(!0,{},s):null,n.state.opened=o.hasClass("jstree-open"),n.state.selected=o.children("a").hasClass("jstree-clicked"),n.state.disabled=o.children("a").hasClass("jstree-disabled"),n.data&&n.data.jstree)for(i in n.data.jstree)n.data.jstree.hasOwnProperty(i)&&(n.state[i]=n.data.jstree[i]);s=o.children("a").children(".jstree-themeicon"),s.length&&(n.icon=!s.hasClass("jstree-themeicon-hidden")&&s.attr("rel")),n.state.icon!==t&&(n.icon=n.state.icon),(n.icon===t||n.icon===null||n.icon==="")&&(n.icon=!0),s=o.children("ul").children("li");do d="j"+this._id+"_"+ ++this._cnt;while(u[d])return n.id=n.li_attr.id?n.li_attr.id.toString():d,s.length?(s.each(function(s,t){r=this._parse_model_from_html(e(t),n.id,a),c=this._model.data[r],n.children.push(r),c.children_d.length&&(n.children_d=n.children_d.concat(c.children_d))}.bind(this)),n.children_d=n.children_d.concat(n.children)):o.hasClass("jstree-closed")&&(n.state.loaded=!1),n.li_attr.class&&(n.li_attr.class=n.li_attr.class.replace("jstree-closed",'').replace("jstree-open",'')),n.a_attr.class&&(n.a_attr.class=n.a_attr.class.replace("jstree-clicked",'').replace("jstree-disabled",'')),u[n.id]=n,n.state.selected&&this._data.core.selected.push(n.id),n.id},_parse_model_from_flat_json:function(e,a,o){o?o=o.concat():o=[],a&&o.unshift(a);var u=e.id.toString(),i=this._model.data,c=this._model.default_state,s,d,l,r,n={id:u,text:e.text||'',icon:e.icon===t||e.icon,parent:a,parents:o,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in c)c.hasOwnProperty(s)&&(n.state[s]=c[s]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(n.icon=e.data.jstree.icon),(n.icon===t||n.icon===null||n.icon==="")&&(n.icon=!0),e&&e.data)if(n.data=e.data,e.data.jstree)for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(n.state[s]=e.data.jstree[s]);if(e&&typeof e.state=="object")for(s in e.state)e.state.hasOwnProperty(s)&&(n.state[s]=e.state[s]);if(e&&typeof e.li_attr=="object")for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(n.li_attr[s]=e.li_attr[s]);if(n.li_attr.id||(n.li_attr.id=u),e&&typeof e.a_attr=="object")for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(n.a_attr[s]=e.a_attr[s]);e&&e.children&&e.children===!0&&(n.state.loaded=!1,n.children=[],n.children_d=[]),i[n.id]=n;for(s=0,d=n.children.length;s<d;s++)l=this._parse_model_from_flat_json(i[n.children[s]],n.id,o),r=i[l],n.children_d.push(l),r.children_d.length&&(n.children_d=n.children_d.concat(r.children_d));return delete e.data,delete e.children,i[n.id].original=e,n.state.selected&&this._data.core.selected.push(n.id),n.id},_parse_model_from_json:function(e,i,o){o?o=o.concat():o=[],i&&o.unshift(i);var a=!1,s,u,r,c,l=this._model.data,d=this._model.default_state,n;do a="j"+this._id+"_"+ ++this._cnt;while(l[a])n={id:!1,text:typeof e=="string"?e:'',icon:!(typeof e=="object"&&e.icon!==t)||e.icon,parent:i,parents:o,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(s in d)d.hasOwnProperty(s)&&(n.state[s]=d[s]);if(e&&e.id&&(n.id=e.id.toString()),e&&e.text&&(n.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(n.icon=e.data.jstree.icon),(n.icon===t||n.icon===null||n.icon==="")&&(n.icon=!0),e&&e.data)if(n.data=e.data,e.data.jstree)for(s in e.data.jstree)e.data.jstree.hasOwnProperty(s)&&(n.state[s]=e.data.jstree[s]);if(e&&typeof e.state=="object")for(s in e.state)e.state.hasOwnProperty(s)&&(n.state[s]=e.state[s]);if(e&&typeof e.li_attr=="object")for(s in e.li_attr)e.li_attr.hasOwnProperty(s)&&(n.li_attr[s]=e.li_attr[s]);if(n.li_attr.id&&!n.id&&(n.id=n.li_attr.id.toString()),n.id||(n.id=a),n.li_attr.id||(n.li_attr.id=n.id),e&&typeof e.a_attr=="object")for(s in e.a_attr)e.a_attr.hasOwnProperty(s)&&(n.a_attr[s]=e.a_attr[s]);if(e&&e.children&&e.children.length){for(s=0,u=e.children.length;s<u;s++)r=this._parse_model_from_json(e.children[s],n.id,o),c=l[r],n.children.push(r),c.children_d.length&&(n.children_d=n.children_d.concat(c.children_d));n.children_d=n.children.concat(n.children_d)}return e&&e.children&&e.children===!0&&(n.state.loaded=!1,n.children=[],n.children_d=[]),delete e.data,delete e.children,n.original=e,l[n.id]=n,n.state.selected&&this._data.core.selected.push(n.id),n.id},_redraw:function(){var i=this._model.force_full_redraw?this._model.data[e.jstree.root].children.concat([]):this._model.changed.concat([]),s=n.createElement("UL"),t,o,a,r=this._data.core.focused;for(o=0,a=i.length;o<a;o++)t=this.redraw_node(i[o],!0,this._model.force_full_redraw),t&&this._model.force_full_redraw&&s.appendChild(t);this._model.force_full_redraw&&(s.className=this.get_container_ul()[0].className,s.setAttribute("role","group"),this.element.empty().append(s)),r!==null&&this.settings.core.restore_focus&&(t=this.get_node(r,!0),t&&t.length&&t.children(".jstree-anchor")[0]!==n.activeElement?t.children(".jstree-anchor").trigger("focus"):this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:i})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(t){var s=this.get_node(t),i=!1,a=!1,o=!1,r=n;if(!s)return!1;if(s.id===e.jstree.root)return this.redraw(!0);if(t=this.get_node(t,!0),!t||!t.length)return!1;if(t.children(".jstree-children").remove(),t=t[0],s.children.length&&s.state.loaded){o=r.createElement("UL"),o.setAttribute("role","group"),o.className="jstree-children";for(i=0,a=s.children.length;i<a;i++)o.appendChild(this.redraw_node(s.children[i],!0,!0));t.appendChild(o)}},redraw_node:function(s,l,g,_){var t=this.get_node(s),i=!1,h=!1,f=!1,o=!1,a=!1,u=!1,c='',p=n,r=this._model.data,y=!1,w=!1,d=null,b=0,j=0,v=!1,m=!1;if(!t)return!1;if(t.id===e.jstree.root)return this.redraw(!0);if(l=l||t.children.length===0,s=n.querySelector?this.element[0].querySelector("#"+("0123456789".indexOf(t.id[0])!==-1?"\\3"+t.id[0]+" "+t.id.substr(1).replace(e.jstree.idregex,"\\$&"):t.id.replace(e.jstree.idregex,"\\$&"))):n.getElementById(t.id),s)s=e(s),g||(i=s.parent().parent()[0],i===this.element[0]&&(i=null),h=s.index()),!l&&t.children.length&&!s.children(".jstree-children").length&&(l=!0),l||(f=s.children(".jstree-children")[0]),y=s.children(".jstree-anchor")[0]===n.activeElement,s.remove();else if(l=!0,!g){if(i=t.parent!==e.jstree.root?e("#"+t.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null,i!==null&&(!i||!r[t.parent].state.opened))return!1;h=e.inArray(t.id,i===null?r[e.jstree.root].children:r[t.parent].children)}s=this._data.core.node.cloneNode(!0),c="jstree-node ";for(o in t.li_attr)if(t.li_attr.hasOwnProperty(o)){if(o==="id")continue;o!=="class"?s.setAttribute(o,t.li_attr[o]):c+=t.li_attr[o]}t.a_attr.id||(t.a_attr.id=t.id+"_anchor"),s.childNodes[1].setAttribute("aria-selected",!!t.state.selected),s.childNodes[1].setAttribute("aria-level",t.parents.length),this.settings.core.compute_elements_positions&&(s.childNodes[1].setAttribute("aria-setsize",r[t.parent].children.length),s.childNodes[1].setAttribute("aria-posinset",r[t.parent].children.indexOf(t.id)+1)),t.state.disabled&&s.childNodes[1].setAttribute("aria-disabled",!0);for(o=0,a=t.children.length;o<a;o++)if(!r[t.children[o]].state.hidden){v=!0;break}if(t.parent!==null&&r[t.parent]&&!t.state.hidden)if(o=e.inArray(t.id,r[t.parent].children),m=t.id,o!==-1){o++;for(a=r[t.parent].children.length;o<a;o++)if(r[r[t.parent].children[o]].state.hidden||(m=r[t.parent].children[o]),m!==t.id)break}t.state.hidden&&(c+=" jstree-hidden"),t.state.loading&&(c+=" jstree-loading"),t.state.loaded&&!v?c+=" jstree-leaf":(c+=t.state.opened&&t.state.loaded?" jstree-open":" jstree-closed",s.childNodes[1].setAttribute("aria-expanded",t.state.opened&&t.state.loaded)),m===t.id&&(c+=" jstree-last"),s.id=t.id,s.className=c,c=(t.state.selected?" jstree-clicked":'')+(t.state.disabled?" jstree-disabled":'');for(a in t.a_attr)if(t.a_attr.hasOwnProperty(a)){if(a==="href"&&t.a_attr[a]==="#")continue;a!=="class"?s.childNodes[1].setAttribute(a,t.a_attr[a]):c+=" "+t.a_attr[a]}if(c.length&&(s.childNodes[1].className="jstree-anchor "+c),(t.icon&&t.icon!==!0||t.icon===!1)&&(t.icon===!1?s.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":t.icon.indexOf("/")===-1&&t.icon.indexOf(".")===-1?s.childNodes[1].childNodes[0].className+=" "+t.icon+" jstree-themeicon-custom":(s.childNodes[1].childNodes[0].style.backgroundImage='url("'+t.icon+'")',s.childNodes[1].childNodes[0].style.backgroundPosition="center center",s.childNodes[1].childNodes[0].style.backgroundSize="auto",s.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?s.childNodes[1].appendChild(p.createTextNode(t.text)):s.childNodes[1].innerHTML+=t.text,l&&t.children.length&&(t.state.opened||_)&&t.state.loaded){u=p.createElement("UL"),u.setAttribute("role","group"),u.className="jstree-children";for(o=0,a=t.children.length;o<a;o++)u.appendChild(this.redraw_node(t.children[o],l,!0));s.appendChild(u)}if(f&&s.appendChild(f),!g){i||(i=this.element[0]);for(o=0,a=i.childNodes.length;o<a;o++)if(i.childNodes[o]&&i.childNodes[o].className&&i.childNodes[o].className.indexOf("jstree-children")!==-1){d=i.childNodes[o];break}d||(d=p.createElement("UL"),d.setAttribute("role","group"),d.className="jstree-children",i.appendChild(d)),i=d,h<i.childNodes.length?i.insertBefore(s,i.childNodes[h]):i.appendChild(s),y&&(b=this.element[0].scrollTop,j=this.element[0].scrollLeft,s.childNodes[1].focus(),this.element[0].scrollTop=b,this.element[0].scrollLeft=j)}return t.state.opened&&!t.state.loaded&&(t.state.opened=!1,setTimeout(function(){this.open_node(t.id,!1,0)}.bind(this),0)),s},open_node:function(n,i,o){var a,c,s,r;if(e.vakata.is_array(n)){n=n.slice();for(a=0,c=n.length;a<c;a++)this.open_node(n[a],i,o);return!0}if(n=this.get_node(n),!n||n.id===e.jstree.root)return!1;if(o=o===t?this.settings.core.animation:o,!this.is_closed(n))return i&&i.call(this,n,!1),!1;if(this.is_loaded(n))return s=this.get_node(n,!0),r=this,s.length&&(o&&s.children(".jstree-children").length&&s.children(".jstree-children").stop(!0,!0),n.children.length&&!this._firstChild(s.children(".jstree-children")[0])&&this.draw_children(n),o?(this.trigger("before_open",{node:n}),s.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").children(".jstree-anchor").attr("aria-expanded",!0).end().children(".jstree-children").stop(!0,!0).slideDown(o,function(){this.style.display="",r.element&&r.trigger("after_open",{node:n})})):(this.trigger("before_open",{node:n}),s[0].className=s[0].className.replace("jstree-closed","jstree-open"),s[0].childNodes[1].setAttribute("aria-expanded",!0))),n.state.opened=!0,i&&i.call(this,n,!0),s.length||this.trigger("before_open",{node:n}),this.trigger("open_node",{node:n}),(!o||!s.length)&&this.trigger("after_open",{node:n}),!0;else{if(this.is_loading(n))return setTimeout(function(){this.open_node(n,i,o)}.bind(this),500);this.load_node(n,function(e,t){return t?this.open_node(e,i,o):!!i&&i.call(this,e,!1)})}},_open_to:function(t){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var n,s,o=t.parents;for(n=0,s=o.length;n<s;n+=1)n!==e.jstree.root&&this.open_node(o[n],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(n,o){var i,r,a,s;if(e.vakata.is_array(n)){n=n.slice();for(i=0,r=n.length;i<r;i++)this.close_node(n[i],o);return!0}if(n=this.get_node(n),!n||n.id===e.jstree.root)return!1;if(this.is_closed(n))return!1;o=o===t?this.settings.core.animation:o,a=this,s=this.get_node(n,!0),n.state.opened=!1,this.trigger("close_node",{node:n}),s.length?o?s.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").children(".jstree-anchor").attr("aria-expanded",!1).end().children(".jstree-children").stop(!0,!0).slideUp(o,function(){this.style.display="",s.children(".jstree-children").remove(),a.element&&a.trigger("after_close",{node:n})}):(s[0].className=s[0].className.replace("jstree-open","jstree-closed"),s.children(".jstree-anchor").attr("aria-expanded",!1),s.children(".jstree-children").remove(),this.trigger("after_close",{node:n})):this.trigger("after_close",{node:n})},toggle_node:function(t){var n,s;if(e.vakata.is_array(t)){t=t.slice();for(n=0,s=t.length;n<s;n++)this.toggle_node(t[n]);return!0}if(this.is_closed(t))return this.open_node(t);if(this.is_open(t))return this.close_node(t)},open_all:function(t,i,s){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),o,a,r;if(!n.length){for(o=0,a=t.children_d.length;o<a;o++)this.is_closed(this._model.data[t.children_d[o]])&&(this._model.data[t.children_d[o]].state.opened=!0);return this.trigger("open_all",{node:t})}s=s||n,r=this,n=this.is_closed(t)?n.find(".jstree-closed").addBack():n.find(".jstree-closed"),n.each(function(){r.open_node(this,function(e,t){t&&this.is_parent(e)&&this.open_all(e,i,s)},i||0)}),s.find(".jstree-closed").length===0&&this.trigger("open_all",{node:this.get_node(s)})},close_all:function(t,i){if(t||(t=e.jstree.root),t=this.get_node(t),!t)return!1;var n=t.id===e.jstree.root?this.get_container_ul():this.get_node(t,!0),a=this,s,o;n.length&&(n=this.is_open(t)?n.find(".jstree-open").addBack():n.find(".jstree-open"),e(n.get().reverse()).each(function(){a.close_node(this,i||0)}));for(s=0,o=t.children_d.length;s<o;s++)this._model.data[t.children_d[s]].state.opened=!1;this.trigger("close_all",{node:t})},is_disabled:function(e){return e=this.get_node(e),e&&e.state&&e.state.disabled},enable_node:function(t){var n,s;if(e.vakata.is_array(t)){t=t.slice();for(n=0,s=t.length;n<s;n++)this.enable_node(t[n]);return!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),this.trigger("enable_node",{node:t})},disable_node:function(t){var n,s;if(e.vakata.is_array(t)){t=t.slice();for(n=0,s=t.length;n<s;n++)this.disable_node(t[n]);return!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),this.trigger("disable_node",{node:t})},is_hidden:function(e){return e=this.get_node(e),e.state.hidden===!0},hide_node:function(t,s){var n,o;if(e.vakata.is_array(t)){t=t.slice();for(n=0,o=t.length;n<o;n++)this.hide_node(t[n],!0);return s||this.redraw(),!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;t.state.hidden||(t.state.hidden=!0,this._node_changed(t.parent),s||this.redraw(),this.trigger("hide_node",{node:t}))},show_node:function(t,s){var n,o;if(e.vakata.is_array(t)){t=t.slice();for(n=0,o=t.length;n<o;n++)this.show_node(t[n],!0);return s||this.redraw(),!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;t.state.hidden&&(t.state.hidden=!1,this._node_changed(t.parent),s||this.redraw(),this.trigger("show_node",{node:t}))},hide_all:function(o){var t,n=this._model.data,s=[];for(t in n)n.hasOwnProperty(t)&&t!==e.jstree.root&&!n[t].state.hidden&&(n[t].state.hidden=!0,s.push(t));return this._model.force_full_redraw=!0,o||this.redraw(),this.trigger("hide_all",{nodes:s}),s},show_all:function(o){var t,n=this._model.data,s=[];for(t in n)n.hasOwnProperty(t)&&t!==e.jstree.root&&n[t].state.hidden&&(n[t].state.hidden=!1,s.push(t));return this._model.force_full_redraw=!0,o||this.redraw(),this.trigger("show_all",{nodes:s}),s},activate_node:function(n,e){if(this.is_disabled(n))return!1;if((!e||typeof e!="object")&&(e={}),this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),!this.settings.core.multiple||!e.metaKey&&!e.ctrlKey&&!e.shiftKey||e.shiftKey&&(!this._data.core.last_clicked||!this.get_parent(n)||this.get_parent(n)!==this._data.core.last_clicked.parent))!this.settings.core.multiple&&(e.metaKey||e.ctrlKey||e.shiftKey)&&this.is_selected(n)?this.deselect_node(n,!1,e):(this.deselect_all(!0),this.select_node(n,!1,!1,e),this._data.core.last_clicked=this.get_node(n));else if(e.shiftKey){var a=this.get_node(n).id,r=this._data.core.last_clicked.id,o=this.get_node(this._data.core.last_clicked.parent).children,i=!1,s,c;for(s=0,c=o.length;s<c;s+=1)o[s]===a&&(i=!i),o[s]===r&&(i=!i),!this.is_disabled(o[s])&&(i||o[s]===a||o[s]===r)?this.is_hidden(o[s])||this.select_node(o[s],!0,!1,e):this.deselect_node(o[s],!0,e);this.trigger("changed",{action:"select_node",node:this.get_node(n),selected:this._data.core.selected,event:e})}else this.is_selected(n)?this.deselect_node(n,!1,e):this.select_node(n,!1,!1,e);this.trigger("activate_node",{node:this.get_node(n),event:e})},hover_node:function(e){if(e=this.get_node(e,!0),!e||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),n=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){n.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){if(e=this.get_node(e,!0),!e||!e.length||!e.children(".jstree-hovered").length)return!1;e.children(".jstree-anchor").removeClass("jstree-hovered"),this.trigger("dehover_node",{node:this.get_node(e)})},select_node:function(t,i,a,o){var n,s,r,c;if(e.vakata.is_array(t)){t=t.slice();for(s=0,r=t.length;s<r;s++)this.select_node(t[s],i,a,o);return!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;n=this.get_node(t,!0),t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),a||(n=this._open_to(t)),n&&n.length&&n.children(".jstree-anchor").addClass("jstree-clicked").attr("aria-selected",!0),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:o}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:o}))},deselect_node:function(t,i,s){var n,a,o;if(e.vakata.is_array(t)){t=t.slice();for(n=0,a=t.length;n<a;n++)this.deselect_node(t[n],i,s);return!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;o=this.get_node(t,!0),t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),o.length&&o.children(".jstree-anchor").removeClass("jstree-clicked").attr("aria-selected",!1),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:s}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:s}))},select_all:function(s){var o=this._data.core.selected.concat([]),t,n;this._data.core.selected=this._model.data[e.jstree.root].children_d.concat();for(t=0,n=this._data.core.selected.length;t<n;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),s||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:o})},deselect_all:function(s){var t=this._data.core.selected.concat([]),e,n;for(e=0,n=this._data.core.selected.length;e<n;e++)this._model.data[this._data.core.selected[e]]&&(this._model.data[this._data.core.selected[e]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:t}),s||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:t})},is_selected:function(t){return!(t=this.get_node(t),!t||t.id===e.jstree.root)&&t.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,function(e){return this.get_node(e)}.bind(this)):this._data.core.selected.slice()},get_top_selected:function(r){var n=this.get_selected(!0),s={},t,i,o,a;for(t=0,i=n.length;t<i;t++)s[n[t].id]=n[t];for(t=0,i=n.length;t<i;t++)for(o=0,a=n[t].children_d.length;o<a;o++)s[n[t].children_d[o]]&&delete s[n[t].children_d[o]];n=[];for(t in s)s.hasOwnProperty(t)&&n.push(t);return r?e.map(n,function(e){return this.get_node(e)}.bind(this)):n},get_bottom_selected:function(i){var n=this.get_selected(!0),s=[],t,o;for(t=0,o=n.length;t<o;t++)n[t].children.length||s.push(n[t].id);return i?e.map(s,function(e){return this.get_node(e)}.bind(this)):s},get_state:function(){var n={core:{open:[],loaded:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},t;for(t in this._model.data)this._model.data.hasOwnProperty(t)&&t!==e.jstree.root&&(this._model.data[t].state.loaded&&this.settings.core.loaded_state&&n.core.loaded.push(t),this._model.data[t].state.opened&&n.core.open.push(t),this._model.data[t].state.selected&&n.core.selected.push(t));return n},set_state:function(n,s){if(n){if(n.core&&n.core.selected&&n.core.initial_selection===t&&(n.core.initial_selection=this._data.core.selected.concat([]).sort().join(",")),n.core){var a,r,c,i,o;if(n.core.loaded)return!this.settings.core.loaded_state||!e.vakata.is_array(n.core.loaded)||!n.core.loaded.length?(delete n.core.loaded,this.set_state(n,s)):this._load_nodes(n.core.loaded,function(){delete n.core.loaded,this.set_state(n,s)}),!1;if(n.core.open)return!e.vakata.is_array(n.core.open)||!n.core.open.length?(delete n.core.open,this.set_state(n,s)):this._load_nodes(n.core.open,function(e){this.open_node(e,!1,0),delete n.core.open,this.set_state(n,s)}),!1;if(n.core.scroll)return n.core.scroll&&n.core.scroll.left!==t&&this.element.scrollLeft(n.core.scroll.left),n.core.scroll&&n.core.scroll.top!==t&&this.element.scrollTop(n.core.scroll.top),delete n.core.scroll,this.set_state(n,s),!1;if(n.core.selected)return i=this,(n.core.initial_selection===t||n.core.initial_selection===this._data.core.selected.concat([]).sort().join(","))&&(this.deselect_all(),e.each(n.core.selected,function(t,e){i.select_node(e,!1,!0)})),delete n.core.initial_selection,delete n.core.selected,this.set_state(n,s),!1;for(o in n)n.hasOwnProperty(o)&&o!=="core"&&e.inArray(o,this.settings.plugins)===-1&&delete n[o];if(e.isEmptyObject(n.core))return delete n.core,this.set_state(n,s),!1}return!e.isEmptyObject(n)||(n=null,s&&s.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(s,t){this._data.core.state=t===!0?{}:this.get_state(),t&&e.vakata.is_function(t)&&(this._data.core.state=t.call(this,this._data.core.state)),this._cnt=0,this._model.data={},this._model.data[e.jstree.root]={id:e.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}},this._data.core.selected=[],this._data.core.last_clicked=null,this._data.core.focused=null;var n=this.get_container_ul()[0].className;s||(this.element.html("<ul class='"+n+"' role='group'><"+"li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='none' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><"+"a class='jstree-anchor' role='treeitem' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node(e.jstree.root,function(s,t){t&&(this.get_container_ul()[0].className=n,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var n=[],s=[],o=this._data.core.selected.concat([]);s.push(t.id),t.state.opened===!0&&n.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){s.push(this.id),n.push(this.id)}),this._load_nodes(s,function(e){this.open_node(n,!1,0),this.select_node(o),this.trigger("refresh_node",{node:t,nodes:e})}.bind(this),!1,!0)},set_id:function(t,s){if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;var n,i,o=this._model.data,a=t.id;s=s.toString(),o[t.parent].children[e.inArray(t.id,o[t.parent].children)]=s;for(n=0,i=t.parents.length;n<i;n++)o[t.parents[n]].children_d[e.inArray(t.id,o[t.parents[n]].children_d)]=s;for(n=0,i=t.children.length;n<i;n++)o[t.children[n]].parent=s;for(n=0,i=t.children_d.length;n<i;n++)o[t.children_d[n]].parents[e.inArray(t.id,o[t.children_d[n]].parents)]=s;return n=e.inArray(t.id,this._data.core.selected),n!==-1&&(this._data.core.selected[n]=s),n=this.get_node(t.id,!0),n&&(n.attr("id",s),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",s)),delete o[t.id],t.id=s,t.li_attr.id=s,o[s]=t,this.trigger("set_id",{node:t,new:t.id,old:a}),!0},get_text:function(t){return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&t.text},set_text:function(t,s){var n,o;if(e.vakata.is_array(t)){t=t.slice();for(n=0,o=t.length;n<o;n++)this.set_text(t[n],s);return!0}return!(t=this.get_node(t),!t||t.id===e.jstree.root)&&(t.text=s,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:s}),!0)},get_json:function(n,t,i){if(n=this.get_node(n||e.jstree.root),!n)return!1;t&&t.flat&&!i&&(i=[]);var s={id:n.id,text:n.text,icon:this.get_icon(n),li_attr:e.extend(!0,{},n.li_attr),a_attr:e.extend(!0,{},n.a_attr),state:{},data:!(t&&t.no_data)&&e.extend(!0,e.vakata.is_array(n.data)?[]:{},n.data)},o,a;if(t&&t.flat?s.parent=n.parent:s.children=[],!t||!t.no_state){for(o in n.state)n.state.hasOwnProperty(o)&&(s.state[o]=n.state[o])}else delete s.state;if(t&&t.no_li_attr&&delete s.li_attr,t&&t.no_a_attr&&delete s.a_attr,t&&t.no_id&&(delete s.id,s.li_attr&&s.li_attr.id&&delete s.li_attr.id,s.a_attr&&s.a_attr.id&&delete s.a_attr.id),t&&t.flat&&n.id!==e.jstree.root&&i.push(s),!t||!t.no_children)for(o=0,a=n.children.length;o<a;o++)t&&t.flat?this.get_json(n.children[o],t,i):s.children.push(this.get_json(n.children[o],t));return t&&t.flat?i:n.id===e.jstree.root?s.children:s},create_node:function(n,s,o,l,d){if(n===null&&(n=e.jstree.root),n=this.get_node(n),!n)return!1;if(o=o===t?"last":o,!o.toString().match(/^(before|after)$/)&&!d&&!this.is_loaded(n))return this.load_node(n,function(){this.create_node(n,s,o,l,!0)});s||(s={text:this.get_string("New node")}),typeof s=="string"?s={text:s}:s=e.extend(!0,{},s),s.text===t&&(s.text=this.get_string("New node"));var i,r,a,c;switch(n.id===e.jstree.root&&(o==="before"&&(o="first"),o==="after"&&(o="last")),o){case"before":i=this.get_node(n.parent),o=e.inArray(n.id,i.children),n=i;break;case"after":i=this.get_node(n.parent),o=e.inArray(n.id,i.children)+1,n=i;break;case"inside":case"first":o=0;break;case"last":o=n.children.length;break;default:o||(o=0);break}if(o>n.children.length&&(o=n.children.length),s.id||(s.id=!0),!this.check("create_node",s,n,o))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(s.id===!0&&delete s.id,s=this._parse_model_from_json(s,n.id,n.parents.concat()),!s)return!1;i=this.get_node(s),r=[],r.push(s),r=r.concat(i.children_d),this.trigger("model",{nodes:r,parent:n.id}),n.children_d=n.children_d.concat(r);for(a=0,c=n.parents.length;a<c;a++)this._model.data[n.parents[a]].children_d=this._model.data[n.parents[a]].children_d.concat(r);s=i,i=[];for(a=0,c=n.children.length;a<c;a++)i[a>=o?a+1:a]=n.children[a];return i[o]=s.id,n.children=i,this.redraw_node(n,!0),this.trigger("create_node",{node:this.get_node(s),parent:n.id,position:o}),l&&l.call(this,this.get_node(s)),s.id},rename_node:function(t,n){var s,o,i;if(e.vakata.is_array(t)){t=t.slice();for(s=0,o=t.length;s<o;s++)this.rename_node(t[s],n);return!0}return!(t=this.get_node(t),!t||t.id===e.jstree.root)&&(i=t.text,!this.check("rename_node",t,this.get_parent(t),n)?(this.settings.core.error.call(this,this._data.core.last_error),!1):(this.set_text(t,n),this.trigger("rename_node",{node:t,text:n,old:i}),!0))},delete_node:function(t){var r,d,n,a,s,i,u,o,c,l,h,m;if(e.vakata.is_array(t)){t=t.slice();for(r=0,d=t.length;r<d;r++)this.delete_node(t[r]);return!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;if(n=this.get_node(t.parent),a=e.inArray(t.id,n.children),l=!1,!this.check("delete_node",t,n,a))return this.settings.core.error.call(this,this._data.core.last_error),!1;a!==-1&&(n.children=e.vakata.array_remove(n.children,a)),s=t.children_d.concat([]),s.push(t.id);for(i=0,u=t.parents.length;i<u;i++)this._model.data[t.parents[i]].children_d=e.vakata.array_filter(this._model.data[t.parents[i]].children_d,function(t){return e.inArray(t,s)===-1});for(o=0,c=s.length;o<c;o++)if(this._model.data[s[o]].state.selected){l=!0;break}l&&(this._data.core.selected=e.vakata.array_filter(this._data.core.selected,function(t){return e.inArray(t,s)===-1})),this.trigger("delete_node",{node:t,parent:n.id}),l&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:n.id});for(o=0,c=s.length;o<c;o++)delete this._model.data[s[o]];return e.inArray(this._data.core.focused,s)!==-1&&(this._data.core.focused=null,h=this.element[0].scrollTop,m=this.element[0].scrollLeft,n.id===e.jstree.root?this._model.data[e.jstree.root].children[0]&&this.get_node(this._model.data[e.jstree.root].children[0],!0).children(".jstree-anchor").triger("focus"):this.get_node(n,!0).children(".jstree-anchor").trigger("focus"),this.element[0].scrollTop=h,this.element[0].scrollLeft=m),this.redraw_node(n,!0),!0},check:function(s,t,n,i,a){t=t&&t.id?t:this.get_node(t),n=n&&n.id?n:this.get_node(n);var o=s.match(/^move_node|copy_node|create_node$/i)?n:t,r=this.settings.core.check_callback;if(s==="move_node"||s==="copy_node"){if((!a||!a.is_multi)&&s==="move_node"&&e.inArray(t.id,n.children)===i)return this._data.core.last_error={error:"check",plugin:"core",id:"core_08",reason:"Moving node to its current position",data:JSON.stringify({chk:s,pos:i,obj:!!(t&&t.id)&&t.id,par:!!(n&&n.id)&&n.id})},!1;if((!a||!a.is_multi)&&(t.id===n.id||s==="move_node"&&e.inArray(t.id,n.children)===i||e.inArray(n.id,t.children_d)!==-1))return this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:s,pos:i,obj:!!(t&&t.id)&&t.id,par:!!(n&&n.id)&&n.id})},!1}return o&&o.data&&(o=o.data),o&&o.functions&&(o.functions[s]===!1||o.functions[s]===!0)?(o.functions[s]===!1&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+s,data:JSON.stringify({chk:s,pos:i,obj:!!(t&&t.id)&&t.id,par:!!(n&&n.id)&&n.id})}),o.functions[s]):!(r===!1||e.vakata.is_function(r)&&r.call(this,s,t,n,i,a)===!1||r&&r[s]===!1)||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+s,data:JSON.stringify({chk:s,pos:i,obj:!!(t&&t.id)&&t.id,par:!!(n&&n.id)&&n.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(n,c,s,p,v,w,h){var g,j,u,_,a,i,b,l,r,o,d,f,y,m;if(c=this.get_node(c),s=s===t?0:s,!c)return!1;if(!s.toString().match(/^(before|after)$/)&&!v&&!this.is_loaded(c))return this.load_node(c,function(){this.move_node(n,c,s,p,!0,!1,h)});if(e.vakata.is_array(n))if(n.length===1)n=n[0];else{for(g=0,j=n.length;g<j;g++)(r=this.move_node(n[g],c,s,p,v,!1,h))&&(c=r,s="after");return this.redraw(),!0}if(n=n&&n.id?n:this.get_node(n),!n||n.id===e.jstree.root)return!1;if(u=(n.parent||e.jstree.root).toString(),a=!s.toString().match(/^(before|after)$/)||c.id===e.jstree.root?c:this.get_node(c.parent),i=h?h:this._model.data[n.id]?this:e.jstree.reference(n.id),b=!i||!i._id||this._id!==i._id,_=i&&i._id&&u&&i._model.data[u]&&i._model.data[u].children?e.inArray(n.id,i._model.data[u].children):-1,i&&i._id&&(n=i._model.data[n.id]),b)return!!(r=this.copy_node(n,c,s,p,v,!1,h))&&(i&&i.delete_node(n),r);switch(c.id===e.jstree.root&&(s==="before"&&(s="first"),s==="after"&&(s="last")),s){case"before":s=e.inArray(c.id,a.children);break;case"after":s=e.inArray(c.id,a.children)+1;break;case"inside":case"first":s=0;break;case"last":s=a.children.length;break;default:s||(s=0);break}if(s>a.children.length&&(s=a.children.length),!this.check("move_node",n,a,s,{core:!0,origin:h,is_multi:i&&i._id&&i._id!==this._id,is_foreign:!i||!i._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(n.parent===a.id){l=a.children.concat(),r=e.inArray(n.id,l),r!==-1&&(l=e.vakata.array_remove(l,r),s>r&&s--),r=[];for(o=0,d=l.length;o<d;o++)r[o>=s?o+1:o]=l[o];r[s]=n.id,a.children=r,this._node_changed(a.id),this.redraw(a.id===e.jstree.root)}else{r=n.children_d.concat(),r.push(n.id);for(o=0,d=n.parents.length;o<d;o++){l=[],m=i._model.data[n.parents[o]].children_d;for(f=0,y=m.length;f<y;f++)e.inArray(m[f],r)===-1&&l.push(m[f]);i._model.data[n.parents[o]].children_d=l}i._model.data[u].children=e.vakata.array_remove_item(i._model.data[u].children,n.id);for(o=0,d=a.parents.length;o<d;o++)this._model.data[a.parents[o]].children_d=this._model.data[a.parents[o]].children_d.concat(r);l=[];for(o=0,d=a.children.length;o<d;o++)l[o>=s?o+1:o]=a.children[o];l[s]=n.id,a.children=l,a.children_d.push(n.id),a.children_d=a.children_d.concat(n.children_d),n.parent=a.id,r=a.parents.concat(),r.unshift(a.id),m=n.parents.length,n.parents=r,r=r.concat();for(o=0,d=n.children_d.length;o<d;o++)this._model.data[n.children_d[o]].parents=this._model.data[n.children_d[o]].parents.slice(0,m*-1),Array.prototype.push.apply(this._model.data[n.children_d[o]].parents,r);(u===e.jstree.root||a.id===e.jstree.root)&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(u),this._node_changed(a.id)),w||this.redraw()}return p&&p.call(this,n,a,s),this.trigger("move_node",{node:n,parent:a.id,position:s,old_parent:u,old_position:_,is_multi:i&&i._id&&i._id!==this._id,is_foreign:!i||!i._id,old_instance:i,new_instance:this}),n.id},copy_node:function(n,a,s,p,v,b,h){var m,g,l,c,r,f,d,u,i,o,j;if(a=this.get_node(a),s=s===t?0:s,!a)return!1;if(!s.toString().match(/^(before|after)$/)&&!v&&!this.is_loaded(a))return this.load_node(a,function(){this.copy_node(n,a,s,p,!0,!1,h)});if(e.vakata.is_array(n))if(n.length===1)n=n[0];else{for(m=0,g=n.length;m<g;m++)(c=this.copy_node(n[m],a,s,p,v,!0,h))&&(a=c,s="after");return this.redraw(),!0}if(n=n&&n.id?n:this.get_node(n),!n||n.id===e.jstree.root)return!1;switch(u=(n.parent||e.jstree.root).toString(),i=!s.toString().match(/^(before|after)$/)||a.id===e.jstree.root?a:this.get_node(a.parent),o=h?h:this._model.data[n.id]?this:e.jstree.reference(n.id),j=!o||!o._id||this._id!==o._id,o&&o._id&&(n=o._model.data[n.id]),a.id===e.jstree.root&&(s==="before"&&(s="first"),s==="after"&&(s="last")),s){case"before":s=e.inArray(a.id,i.children);break;case"after":s=e.inArray(a.id,i.children)+1;break;case"inside":case"first":s=0;break;case"last":s=i.children.length;break;default:s||(s=0);break}if(s>i.children.length&&(s=i.children.length),!this.check("copy_node",n,i,s,{core:!0,origin:h,is_multi:o&&o._id&&o._id!==this._id,is_foreign:!o||!o._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(d=o?o.get_json(n,{no_id:!0,no_data:!0,no_state:!0}):n,!d)return!1;if(d.id===!0&&delete d.id,d=this._parse_model_from_json(d,i.id,i.parents.concat()),!d)return!1;c=this.get_node(d),n&&n.state&&n.state.loaded===!1&&(c.state.loaded=!1),l=[],l.push(d),l=l.concat(c.children_d),this.trigger("model",{nodes:l,parent:i.id});for(r=0,f=i.parents.length;r<f;r++)this._model.data[i.parents[r]].children_d=this._model.data[i.parents[r]].children_d.concat(l);l=[];for(r=0,f=i.children.length;r<f;r++)l[r>=s?r+1:r]=i.children[r];return l[s]=c.id,i.children=l,i.children_d.push(c.id),i.children_d=i.children_d.concat(c.children_d),i.id===e.jstree.root&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(i.id),b||this.redraw(i.id===e.jstree.root),p&&p.call(this,c,i,s),this.trigger("copy_node",{node:c,original:n,parent:i.id,position:s,old_parent:u,old_position:o&&o._id&&u&&o._model.data[u]&&o._model.data[u].children?e.inArray(n.id,o._model.data[u].children):-1,is_multi:o&&o._id&&o._id!==this._id,is_foreign:!o||!o._id,old_instance:o,new_instance:this}),c.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.vakata.is_array(t)||(t=[t]),!t.length)return!1;var a=[],n,s,c;for(s=0,c=t.length;s<c;s++)n=this.get_node(t[s]),n&&n.id&&n.id!==e.jstree.root&&a.push(n);if(!a.length)return!1;i=a,r=this,o="move_node",this.trigger("cut",{node:t})},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.vakata.is_array(t)||(t=[t]),!t.length)return!1;var a=[],n,s,c;for(s=0,c=t.length;s<c;s++)n=this.get_node(t[s]),n&&n.id&&n.id!==e.jstree.root&&a.push(n);if(!a.length)return!1;i=a,r=this,o="copy_node",this.trigger("copy",{node:t})},get_buffer:function(){return{mode:o,node:i,inst:r}},can_paste:function(){return o!==!1&&i!==!1},paste:function(e,t){if(e=this.get_node(e),!e||!o||!o.match(/^(copy_node|move_node)$/)||!i)return!1;this[o](i,e,t,!1,!1,!1,r)&&this.trigger("paste",{parent:e.id,node:i,mode:o}),i=!1,o=!1,r=!1},clear_buffer:function(){i=!1,o=!1,r=!1,this.trigger("clear_buffer")},edit:function(t,l,m){var h,d,s,r,i,c,o,u,a,f=!1;if(t=this.get_node(t),!t)return!1;if(!this.check("edit",t,this.get_parent(t)))return this.settings.core.error.call(this,this._data.core.last_error),!1;a=t,l=typeof l=="string"?l:t.text,this.set_text(t,""),t=this._open_to(t),a.text=l,h=this._data.core.rtl,d=this.element.width(),this._data.core.focused=a.id,s=t.children(".jstree-anchor").trigger("focus"),r=e("<span></span>"),i=l,c=e("<div></div>",{css:{position:"absolute",top:"-200px",left:h?"0px":"-1000px",visibility:"hidden"}}).appendTo(n.body),o=e("<input />",{value:i,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:function(d){d.stopImmediatePropagation(),d.preventDefault();var h=r.children(".jstree-rename-input"),n=h.val(),u=this.settings.core.force_text,l;n===""&&(n=i),c.remove(),r.replaceWith(s),r.remove(),i=u?i:e("<div></div>").append(e.parseHTML(i)).html(),t=this.get_node(t),this.set_text(t,i),l=!!this.rename_node(t,u?e("<div></div>").text(n).text():e("<div></div>").append(e.parseHTML(n)).html()),l||this.set_text(t,i),this._data.core.focused=a.id,setTimeout(function(){var e=this.get_node(a.id,!0);e.length&&(this._data.core.focused=a.id,e.children(".jstree-anchor").trigger("focus"))}.bind(this),0),m&&m.call(this,a,l,f,n),o=null}.bind(this),keydown:function(t){var e=t.which;e===27&&(f=!0,this.value=i),(e===27||e===13||e===37||e===38||e===39||e===40||e===32)&&t.stopImmediatePropagation(),(e===27||e===13)&&(t.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(){o.width(Math.min(c.text("pW"+this.value).width(),d))},keypress:function(e){if(e.which===13)return!1}}),u={fontFamily:s.css("fontFamily")||'',fontSize:s.css("fontSize")||'',fontWeight:s.css("fontWeight")||'',fontStyle:s.css("fontStyle")||'',fontStretch:s.css("fontStretch")||'',fontVariant:s.css("fontVariant")||'',letterSpacing:s.css("letterSpacing")||'',wordSpacing:s.css("wordSpacing")||''},r.attr("class",s.attr("class")).append(s.contents().clone()).append(o),s.replaceWith(r),c.css(u),o.css(u).width(Math.min(c.text("pW"+o[0].value).width(),d))[0].select(),e(n).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(t){o&&t.target!==o&&e(o).trigger("blur")})},set_theme:function(t,n){if(!t)return!1;if(n===!0){var s=this.settings.core.themes.dir;s||(s=e.jstree.path+"/themes"),n=s+"/"+t+"/style.css"}n&&e.inArray(n,f)===-1&&(e("head").append('<link rel="stylesheet" href="'+n+'" type="text/css" />'),f.push(n)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped"),this.trigger("show_stripes")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped"),this.trigger("hide_stripes")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots"),this.trigger("show_dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots"),this.trigger("hide_dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons"),this.trigger("show_icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons"),this.trigger("hide_icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},show_ellipsis:function(){this._data.core.themes.ellipsis=!0,this.get_container_ul().addClass("jstree-ellipsis"),this.trigger("show_ellipsis")},hide_ellipsis:function(){this._data.core.themes.ellipsis=!1,this.get_container_ul().removeClass("jstree-ellipsis"),this.trigger("hide_ellipsis")},toggle_ellipsis:function(){this._data.core.themes.ellipsis?this.hide_ellipsis():this.show_ellipsis()},set_icon:function(s,n){var a,r,i,o;if(e.vakata.is_array(s)){s=s.slice();for(a=0,r=s.length;a<r;a++)this.set_icon(s[a],n);return!0}return!(s=this.get_node(s),!s||s.id===e.jstree.root)&&(o=s.icon,s.icon=!!(n===!0||n===null||n===t||n==='')||n,i=this.get_node(s,!0).children(".jstree-anchor").children(".jstree-themeicon"),n===!1?(i.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"),this.hide_icon(s)):n===!0||n===null||n===t||n===''?(i.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"),o===!1&&this.show_icon(s)):n.indexOf("/")===-1&&n.indexOf(".")===-1?(i.removeClass(o).css("background",""),i.addClass(n+" jstree-themeicon-custom").attr("rel",n),o===!1&&this.show_icon(s)):(i.removeClass(o).css("background",""),i.addClass("jstree-themeicon-custom").css("background","url('"+n+"') center center no-repeat").attr("rel",n),o===!1&&this.show_icon(s)),!0)},get_icon:function(t){return t=this.get_node(t),!(!t||t.id===e.jstree.root)&&t.icon},hide_icon:function(t){var n,s;if(e.vakata.is_array(t)){t=t.slice();for(n=0,s=t.length;n<s;n++)this.hide_icon(t[n]);return!0}return!(t=this.get_node(t),!t||t===e.jstree.root)&&(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var n,o,s;if(e.vakata.is_array(t)){t=t.slice();for(n=0,o=t.length;n<o;n++)this.show_icon(t[n]);return!0}return!(t=this.get_node(t),!t||t===e.jstree.root)&&(s=this.get_node(t,!0),t.icon=!s.length||s.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),s.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,s){t=e(t)[0];var n=s?{}:[];return t&&t.attributes&&e.each(t.attributes,function(o,t){if(e.inArray(t.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])!==-1)return;t.value!==null&&e.vakata.trim(t.value)!==''&&(s?n[t.name]=t.value:n.push(t.name))}),n},e.vakata.array_unique=function(n){var s=[],e,a,o,i={};for(e=0,o=n.length;e<o;e++)i[n[e]]===t&&(s.push(n[e]),i[n[e]]=!0);return s},e.vakata.array_remove=function(e,t){return e.splice(t,1),e},e.vakata.array_remove_item=function(t,s){var n=e.inArray(s,t);return n!==-1?e.vakata.array_remove(t,n):t},e.vakata.array_filter=function(t,s,o,n,e){if(t.filter)return t.filter(s,o);n=[];for(e in t)~~e+''===e+''&&e>=0&&s.call(o,t[e],+e,t)&&n.push(t[e]);return n},e.vakata.trim=function(e){return String.prototype.trim?String.prototype.trim.call(e.toString()):e.toString().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,'')},e.vakata.is_function=function(e){return typeof e=="function"&&typeof e.nodeType!="number"},e.vakata.is_array=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},Function.prototype.bind||(Function.prototype.bind=function(){var e=this,t=arguments[0],n=Array.prototype.slice.call(arguments,1);if(typeof e!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");return function(){var s=n.concat(Array.prototype.slice.call(arguments));return e.apply(t,s)}}),e.jstree.plugins.changed=function(n,t){var e=[];this.trigger=function(a,s){if(s||(s={}),a.replace(".jstree",'')==="changed"){s.changed={selected:[],deselected:[]};var n,o,i={};for(n=0,o=e.length;n<o;n++)i[e[n]]=1;for(n=0,o=s.selected.length;n<o;n++)i[s.selected[n]]?i[s.selected[n]]=2:s.changed.selected.push(s.selected[n]);for(n=0,o=e.length;n<o;n++)i[e[n]]===1&&s.changed.deselected.push(e[n]);e=s.selected.slice()}t.trigger.call(this,a,s)},this.refresh=function(){return e=[],t.refresh.apply(this,arguments)}},u=n.createElement("I"),u.className="jstree-icon jstree-checkbox",u.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:'',tie_selection:!0,cascade_to_disabled:!0,cascade_to_hidden:!0},e.jstree.plugins.checkbox=function(s,n){this.bind=function(){n.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")}.bind(this)).on("loading.jstree",function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()}.bind(this)),this.settings.checkbox.cascade.indexOf("undetermined")!==-1&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(this._undetermined.bind(this),50)}.bind(this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",function(a,o){var n=this._model.data,i=n[o.parent],t=o.nodes,e,s;for(e=0,s=t.length;e<s;e++)n[t[e]].state.checked=n[t[e]].state.checked||n[t[e]].original&&n[t[e]].original.state&&n[t[e]].original.state.checked,n[t[e]].state.checked&&this._data.checkbox.selected.push(t[e])}.bind(this)),(this.settings.checkbox.cascade.indexOf("up")!==-1||this.settings.checkbox.cascade.indexOf("down")!==-1)&&this.element.on("model.jstree",function(f,h){var o=this._model.data,n=o[h.parent],a=h.nodes,c=[],u,t,i,r,l,d,m=this.settings.checkbox.cascade,s=this.settings.checkbox.tie_selection;if(m.indexOf("down")!==-1)if(n.state[s?"selected":"checked"]){for(t=0,i=a.length;t<i;t++)o[a[t]].state[s?"selected":"checked"]=!0;this._data[s?"core":"checkbox"].selected=this._data[s?"core":"checkbox"].selected.concat(a)}else for(t=0,i=a.length;t<i;t++)if(o[a[t]].state[s?"selected":"checked"]){for(r=0,l=o[a[t]].children_d.length;r<l;r++)o[o[a[t]].children_d[r]].state[s?"selected":"checked"]=!0;this._data[s?"core":"checkbox"].selected=this._data[s?"core":"checkbox"].selected.concat(o[a[t]].children_d)}if(m.indexOf("up")!==-1){for(t=0,i=n.children_d.length;t<i;t++)o[n.children_d[t]].children.length||c.push(o[n.children_d[t]].parent);c=e.vakata.array_unique(c);for(r=0,l=c.length;r<l;r++)for(n=o[c[r]];n&&n.id!==e.jstree.root;){u=0;for(t=0,i=n.children.length;t<i;t++)u+=o[n.children[t]].state[s?"selected":"checked"];if(u===i)n.state[s?"selected":"checked"]=!0,this._data[s?"core":"checkbox"].selected.push(n.id),d=this.get_node(n,!0),d&&d.length&&d.attr("aria-selected",!0).children(".jstree-anchor").addClass(s?"jstree-clicked":"jstree-checked");else break;n=this.get_node(n.parent)}}this._data[s?"core":"checkbox"].selected=e.vakata.array_unique(this._data[s?"core":"checkbox"].selected)}.bind(this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",function(g,m){var p=this,r=m.node,h=this._model.data,n=this.get_node(r.parent),t,s,d,c,u=this.settings.checkbox.cascade,i=this.settings.checkbox.tie_selection,o={},a=this._data[i?"core":"checkbox"].selected,f,l;for(t=0,s=a.length;t<s;t++)o[a[t]]=!0;if(u.indexOf("down")!==-1){f=this._cascade_new_checked_state(r.id,!0),l=r.children_d.concat(r.id);for(t=0,s=l.length;t<s;t++)f.indexOf(l[t])>-1?o[l[t]]=!0:delete o[l[t]]}if(u.indexOf("up")!==-1)for(;n&&n.id!==e.jstree.root;){d=0;for(t=0,s=n.children.length;t<s;t++)d+=h[n.children[t]].state[i?"selected":"checked"];if(d===s)n.state[i?"selected":"checked"]=!0,o[n.id]=!0,c=this.get_node(n,!0),c&&c.length&&c.attr("aria-selected",!0).children(".jstree-anchor").addClass(i?"jstree-clicked":"jstree-checked");else break;n=this.get_node(n.parent)}a=[];for(t in o)o.hasOwnProperty(t)&&a.push(t);this._data[i?"core":"checkbox"].selected=a}.bind(this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",function(){var s=this.get_node(e.jstree.root),i=this._model.data,n,o,t;for(n=0,o=s.children_d.length;n<o;n++)t=i[s.children_d[n]],t&&t.original&&t.original.state&&t.original.state.undetermined&&(t.original.state.undetermined=!1)}.bind(this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",function(p,c){var f=this,n=c.node,u=this.get_node(n,!0),o,r,t,a=this.settings.checkbox.cascade,i=this.settings.checkbox.tie_selection,s=this._data[i?"core":"checkbox"].selected,h={},m=[],l=n.children_d.concat(n.id),d;if(a.indexOf("down")!==-1&&(d=this._cascade_new_checked_state(n.id,!1),s=e.vakata.array_filter(s,function(e){return l.indexOf(e)===-1||d.indexOf(e)>-1})),a.indexOf("up")!==-1&&s.indexOf(n.id)===-1){for(o=0,r=n.parents.length;o<r;o++)t=this._model.data[n.parents[o]],t.state[i?"selected":"checked"]=!1,t&&t.original&&t.original.state&&t.original.state.undetermined&&(t.original.state.undetermined=!1),t=this.get_node(n.parents[o],!0),t&&t.length&&t.attr("aria-selected",!1).children(".jstree-anchor").removeClass(i?"jstree-clicked":"jstree-checked");s=e.vakata.array_filter(s,function(e){return n.parents.indexOf(e)===-1})}this._data[i?"core":"checkbox"].selected=s}.bind(this)),this.settings.checkbox.cascade.indexOf("up")!==-1&&this.element.on("delete_node.jstree",function(l,c){for(var t=this.get_node(c.parent),r=this._model.data,o,i,a,s,n=this.settings.checkbox.tie_selection;t&&t.id!==e.jstree.root&&!t.state[n?"selected":"checked"];){a=0;for(o=0,i=t.children.length;o<i;o++)a+=r[t.children[o]].state[n?"selected":"checked"];if(i>0&&a===i)t.state[n?"selected":"checked"]=!0,this._data[n?"core":"checkbox"].selected.push(t.id),s=this.get_node(t,!0),s&&s.length&&s.attr("aria-selected",!0).children(".jstree-anchor").addClass(n?"jstree-clicked":"jstree-checked");else break;t=this.get_node(t.parent)}}.bind(this)).on("move_node.jstree",function(h,r){var l=r.is_multi,d=r.old_parent,u=this.get_node(r.parent),c=this._model.data,t,a,o,i,s,n=this.settings.checkbox.tie_selection;if(!l)for(t=this.get_node(d);t&&t.id!==e.jstree.root&&!t.state[n?"selected":"checked"];){a=0;for(o=0,i=t.children.length;o<i;o++)a+=c[t.children[o]].state[n?"selected":"checked"];if(i>0&&a===i)t.state[n?"selected":"checked"]=!0,this._data[n?"core":"checkbox"].selected.push(t.id),s=this.get_node(t,!0),s&&s.length&&s.attr("aria-selected",!0).children(".jstree-anchor").addClass(n?"jstree-clicked":"jstree-checked");else break;t=this.get_node(t.parent)}for(t=u;t&&t.id!==e.jstree.root;){a=0;for(o=0,i=t.children.length;o<i;o++)a+=c[t.children[o]].state[n?"selected":"checked"];if(a===i)t.state[n?"selected":"checked"]||(t.state[n?"selected":"checked"]=!0,this._data[n?"core":"checkbox"].selected.push(t.id),s=this.get_node(t,!0),s&&s.length&&s.attr("aria-selected",!0).children(".jstree-anchor").addClass(n?"jstree-clicked":"jstree-checked"));else if(t.state[n?"selected":"checked"])t.state[n?"selected":"checked"]=!1,this._data[n?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[n?"core":"checkbox"].selected,t.id),s=this.get_node(t,!0),s&&s.length&&s.attr("aria-selected",!1).children(".jstree-anchor").removeClass(n?"jstree-clicked":"jstree-checked");else break;t=this.get_node(t.parent)}}.bind(this))},this.get_undetermined=function(h){if(this.settings.checkbox.cascade.indexOf("undetermined")===-1)return[];var s,l,n,c,i={},o=this._model.data,d=this.settings.checkbox.tie_selection,r=this._data[d?"core":"checkbox"].selected,a=[],m=this,u=[];for(s=0,l=r.length;s<l;s++)if(o[r[s]]&&o[r[s]].parents)for(n=0,c=o[r[s]].parents.length;n<c;n++){if(i[o[r[s]].parents[n]]!==t)break;o[r[s]].parents[n]!==e.jstree.root&&(i[o[r[s]].parents[n]]=!0,a.push(o[r[s]].parents[n]))}this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var r=m.get_node(this),d;if(!r)return;if(r.state.loaded){for(s=0,l=r.children_d.length;s<l;s++)if(d=o[r.children_d[s]],!d.state.loaded&&d.original&&d.original.state&&d.original.state.undetermined&&d.original.state.undetermined===!0){i[d.id]===t&&d.id!==e.jstree.root&&(i[d.id]=!0,a.push(d.id));for(n=0,c=d.parents.length;n<c;n++)i[d.parents[n]]===t&&d.parents[n]!==e.jstree.root&&(i[d.parents[n]]=!0,a.push(d.parents[n]))}}else if(r.original&&r.original.state&&r.original.state.undetermined&&r.original.state.undetermined===!0){i[r.id]===t&&r.id!==e.jstree.root&&(i[r.id]=!0,a.push(r.id));for(n=0,c=r.parents.length;n<c;n++)i[r.parents[n]]===t&&r.parents[n]!==e.jstree.root&&(i[r.parents[n]]=!0,a.push(r.parents[n]))}});for(s=0,l=a.length;s<l;s++)o[a[s]].state[d?"selected":"checked"]||u.push(h?o[a[s]]:a[s]);return u},this._undetermined=function(){if(this.element===null)return;var n=this.get_undetermined(!1),e,s,t;this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");for(e=0,s=n.length;e<s;e++)t=this.get_node(n[e],!0),t&&t.length&&t.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")},this.redraw_node=function(e,c,a){if(e=n.redraw_node.apply(this,arguments),e){var t,i,s=null,o=null;for(t=0,i=e.childNodes.length;t<i;t++)if(e.childNodes[t]&&e.childNodes[t].className&&e.childNodes[t].className.indexOf("jstree-anchor")!==-1){s=e.childNodes[t];break}s&&(!this.settings.checkbox.tie_selection&&this._model.data[e.id].state.checked&&(s.className+=" jstree-checked"),o=u.cloneNode(!1),this._model.data[e.id].state.checkbox_disabled&&(o.className+=" jstree-checkbox-disabled"),s.insertBefore(o,s.childNodes[0]))}return!a&&this.settings.checkbox.cascade.indexOf("undetermined")!==-1&&(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(this._undetermined.bind(this),50)),e},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var s=this.settings.checkbox.cascade,n,o,i=this.settings.checkbox.tie_selection,r=this._data[i?"core":"checkbox"].selected,a=this._model.data;if(!t||t.state[i?"selected":"checked"]===!0||s.indexOf("undetermined")===-1||s.indexOf("down")===-1&&s.indexOf("up")===-1)return!1;if(!t.state.loaded&&t.original.state.undetermined===!0)return!0;for(n=0,o=t.children_d.length;n<o;n++)if(e.inArray(t.children_d[n],r)!==-1||!a[t.children_d[n]].state.loaded&&a[t.children_d[n]].original.state.undetermined)return!0;return!1},this.disable_checkbox=function(t){var n,o,s;if(e.vakata.is_array(t)){t=t.slice();for(n=0,o=t.length;n<o;n++)this.disable_checkbox(t[n]);return!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;s=this.get_node(t,!0),t.state.checkbox_disabled||(t.state.checkbox_disabled=!0,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:t}))},this.enable_checkbox=function(t){var n,o,s;if(e.vakata.is_array(t)){t=t.slice();for(n=0,o=t.length;n<o;n++)this.enable_checkbox(t[n]);return!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;s=this.get_node(t,!0),t.state.checkbox_disabled&&(t.state.checkbox_disabled=!1,s&&s.length&&s.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:t}))},this.activate_node=function(s,t){if(e(t.target).hasClass("jstree-checkbox-disabled"))return!1;if(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(t.target).hasClass("jstree-checkbox"))&&(t.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(t.target).hasClass("jstree-checkbox"))return n.activate_node.call(this,s,t);if(this.is_disabled(s))return!1;this.is_checked(s)?this.uncheck_node(s,t):this.check_node(s,t),this.trigger("activate_node",{node:this.get_node(s)})},this._cascade_new_checked_state=function(l,r){var u=this,o,d,n,c,a,h,t=this.settings.checkbox.tie_selection,e=this._model.data[l],s=[],i=[];if((this.settings.checkbox.cascade_to_disabled||!e.state.disabled)&&(this.settings.checkbox.cascade_to_hidden||!e.state.hidden)){if(e.children)for(o=0,d=e.children.length;o<d;o++)c=e.children[o],n=u._cascade_new_checked_state(c,r),s=s.concat(n),n.indexOf(c)>-1&&i.push(c);a=u.get_node(e,!0),h=i.length>0&&i.length<e.children.length,e.original&&e.original.state&&e.original.state.undetermined&&(e.original.state.undetermined=h),h?(e.state[t?"selected":"checked"]=!1,a.attr("aria-selected",!1).children(".jstree-anchor").removeClass(t?"jstree-clicked":"jstree-checked")):r&&i.length===e.children.length?(e.state[t?"selected":"checked"]=r,s.push(e.id),a.attr("aria-selected",!0).children(".jstree-anchor").addClass(t?"jstree-clicked":"jstree-checked")):(e.state[t?"selected":"checked"]=!1,a.attr("aria-selected",!1).children(".jstree-anchor").removeClass(t?"jstree-clicked":"jstree-checked"))}else n=this.get_checked_descendants(l),e.state[t?"selected":"checked"]&&n.push(e.id),s=s.concat(n);return s},this.get_checked_descendants=function(n){var t=this,s=t.settings.checkbox.tie_selection,o=t._model.data[n];return e.vakata.array_filter(o.children_d,function(e){return t._model.data[e].state[s?"selected":"checked"]})},this.check_node=function(t,o){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,o);var n,s,i,a;if(e.vakata.is_array(t)){t=t.slice();for(s=0,i=t.length;s<i;s++)this.check_node(t[s],o);return!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;n=this.get_node(t,!0),t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),n&&n.length&&n.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:o}))},this.uncheck_node=function(t,s){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,s);var n,i,o;if(e.vakata.is_array(t)){t=t.slice();for(n=0,i=t.length;n<i;n++)this.uncheck_node(t[n],s);return!0}if(t=this.get_node(t),!t||t.id===e.jstree.root)return!1;o=this.get_node(t,!0),t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),o.length&&o.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:s}))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var s=this._data.checkbox.selected.concat([]),t,n;this._data.checkbox.selected=this._model.data[e.jstree.root].children_d.concat();for(t=0,n=this._data.checkbox.selected.length;t<n;t++)this._model.data[this._data.checkbox.selected[t]]&&(this._model.data[this._data.checkbox.selected[t]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var n=this._data.checkbox.selected.concat([]),e,t;for(e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:n})},this.is_checked=function(t){return this.settings.checkbox.tie_selection?this.is_selected(t):!(t=this.get_node(t),!t||t.id===e.jstree.root)&&t.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,function(e){return this.get_node(e)}.bind(this)):this._data.checkbox.selected.slice()},this.get_top_checked=function(a){if(this.settings.checkbox.tie_selection)return this.get_top_selected(a);var n=this.get_checked(!0),s={},t,i,o,r;for(t=0,i=n.length;t<i;t++)s[n[t].id]=n[t];for(t=0,i=n.length;t<i;t++)for(o=0,r=n[t].children_d.length;o<r;o++)s[n[t].children_d[o]]&&delete s[n[t].children_d[o]];n=[];for(t in s)s.hasOwnProperty(t)&&n.push(t);return a?e.map(n,function(e){return this.get_node(e)}.bind(this)):n},this.get_bottom_checked=function(o){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(o);var n=this.get_checked(!0),s=[],t,i;for(t=0,i=n.length;t<i;t++)n[t].children.length||s.push(n[t].id);return o?e.map(s,function(e){return this.get_node(e)}.bind(this)):s},this.load_node=function(o){var s,i,r,c,a,t;if(!e.vakata.is_array(o)&&!this.settings.checkbox.tie_selection)if(t=this.get_node(o),t&&t.state.loaded)for(s=0,i=t.children_d.length;s<i;s++)this._model.data[t.children_d[s]].state.checked&&(a=!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.children_d[s]));return n.load_node.apply(this,arguments)},this.get_state=function(){var e=n.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection?e:(e.checkbox=this._data.checkbox.selected.slice(),e)},this.set_state=function(t,o){var s=n.set_state.apply(this,arguments),i;return s&&t.checkbox?(this.settings.checkbox.tie_selection||(this.uncheck_all(),i=this,e.each(t.checkbox,function(t,e){i.check_node(e)})),delete t.checkbox,this.set_state(t,o),!1):s},this.refresh=function(){return this.settings.checkbox.tie_selection&&(this._data.checkbox.selected=[]),n.refresh.apply(this,arguments)}},e.jstree.defaults.conditionalselect=function(){return!0},e.jstree.plugins.conditionalselect=function(t,e){this.activate_node=function(t,n){if(this.settings.conditionalselect.call(this,this.get_node(t),n))return e.activate_node.call(this,t,n)}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(n){var t=e.jstree.reference(n.reference),s=t.get_node(n.reference);t.create_node(s,{},"last",function(e){try{t.edit(e)}catch(n){setTimeout(function(){t.edit(e)},0)}})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var n=e.jstree.reference(t.reference),s=n.get_node(t.reference);n.edit(s)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(n){var t=e.jstree.reference(n.reference),s=t.get_node(n.reference);t.is_selected(s)?t.delete_node(t.get_selected()):t.delete_node(s)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(n){var t=e.jstree.reference(n.reference),s=t.get_node(n.reference);t.is_selected(s)?t.cut(t.get_top_selected()):t.cut(s)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(n){var t=e.jstree.reference(n.reference),s=t.get_node(n.reference);t.is_selected(s)?t.copy(t.get_top_selected()):t.copy(s)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var n=e.jstree.reference(t.reference),s=n.get_node(t.reference);n.paste(s)}}}}}}},e.jstree.plugins.contextmenu=function(o,s){this.bind=function(){s.bind.call(this);var o=0,t=null,i,a;this.element.on("init.jstree loading.jstree ready.jstree",function(){this.get_container_ul().addClass("jstree-contextmenu")}.bind(this)).on("contextmenu.jstree",".jstree-anchor",function(e,n){if(e.target.tagName.toLowerCase()==="input")return;e.preventDefault(),o=e.ctrlKey?+new Date:0,(n||t)&&(o=+new Date+1e4),t&&clearTimeout(t),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)}.bind(this)).on("click.jstree",".jstree-anchor",function(){this._data.contextmenu.visible&&(!o||+new Date-o>250)&&e.vakata.context.hide(),o=0}.bind(this)).on("touchstart.jstree",".jstree-anchor",function(n){if(!n.originalEvent||!n.originalEvent.changedTouches||!n.originalEvent.changedTouches[0])return;i=n.originalEvent.changedTouches[0].clientX,a=n.originalEvent.changedTouches[0].clientY,t=setTimeout(function(){e(n.currentTarget).trigger("contextmenu",!0)},750)}).on("touchmove.vakata.jstree",function(n){t&&n.originalEvent&&n.originalEvent.changedTouches&&n.originalEvent.changedTouches[0]&&(Math.abs(i-n.originalEvent.changedTouches[0].clientX)>10||Math.abs(a-n.originalEvent.changedTouches[0].clientY)>10)&&(clearTimeout(t),e.vakata.context.hide())}).on("touchend.vakata.jstree",function(){t&&clearTimeout(t)}),e(n).on("context_hide.vakata.jstree",function(n,t){this._data.contextmenu.visible=!1,e(t.reference).removeClass("jstree-context")}.bind(this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),e(n).off("context_hide.vakata.jstree"),s.teardown.call(this)},this.show_contextmenu=function(n,o,i,c){if(n=this.get_node(n),!n||n.id===e.jstree.root)return!1;var r=this.settings.contextmenu,l=this.get_node(n,!0),d=l.children(".jstree-anchor"),a=!1,s=!1;(r.show_at_node||o===t||i===t)&&(a=d.offset(),o=a.left,i=a.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(n)&&this.activate_node(n,c),s=r.items,e.vakata.is_function(s)&&(s=s.call(this,n,function(e){this._show_contextmenu(n,o,i,e)}.bind(this))),e.isPlainObject(s)&&this._show_contextmenu(n,o,i,s)},this._show_contextmenu=function(t,s,o,a){var r=this.get_node(t,!0),i=r.children(".jstree-anchor");e(n).one("context_show.vakata.jstree",function(s,t){var n="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(t.element).addClass(n),i.addClass("jstree-context")}.bind(this)),this._data.contextmenu.visible=!0,e.vakata.context.show(i,{x:s,y:o},a),this.trigger("show_contextmenu",{node:t,x:s,y:o})}},function(t){var s=!1,e={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};t.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(s){t(n).triggerHandler("context_"+s+".vakata",{reference:e.reference,element:e.element,position:{x:e.position_x,y:e.position_y}})},_execute:function(n){return n=e.items[n],!!(n&&(!n._disabled||t.vakata.is_function(n._disabled)&&!n._disabled({item:n,reference:e.reference,element:e.element}))&&n.action)&&n.action.call(null,{item:n,reference:e.reference,element:e.element,position:{x:e.position_x,y:e.position_y}})},_parse:function(a,s){if(!a)return!1;s||(e.html="",e.items=[]);var n="",o=!1,i;return s&&(n+="<ul>"),t.each(a,function(a,s){if(!s)return!0;e.items.push(s),!o&&s.separator_before&&(n+="<li class='vakata-context-separator'><a href='#' "+(t.vakata.context.settings.icons?'':'class="vakata-context-no-icons"')+">&#160;<"+"/a><"+"/li>"),o=!1,n+="<li class='"+(s._class||"")+(s._disabled===!0||t.vakata.is_function(s._disabled)&&s._disabled({item:s,reference:e.reference,element:e.element})?" vakata-contextmenu-disabled ":"")+"' "+(s.shortcut?" data-shortcut='"+s.shortcut+"' ":'')+">",n+="<a href='#' rel='"+(e.items.length-1)+"' "+(s.title?"title='"+s.title+"'":"")+">",t.vakata.context.settings.icons&&(n+="<i ",s.icon&&(s.icon.indexOf("/")!==-1||s.icon.indexOf(".")!==-1?n+=" style='background:url(\""+s.icon+"\") center center no-repeat' ":n+=" class='"+s.icon+"' "),n+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),n+=(t.vakata.is_function(s.label)?s.label({item:a,reference:e.reference,element:e.element}):s.label)+(s.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+s.shortcut+'">'+(s.shortcut_label||'')+"</span>":'')+"<"+"/a>",s.submenu&&(i=t.vakata.context._parse(s.submenu,!0),i&&(n+=i)),n+="</li>",s.separator_after&&(n+="<li class='vakata-context-separator'><a href='#' "+(t.vakata.context.settings.icons?'':'class="vakata-context-no-icons"')+">&#160;<"+"/a><"+"/li>",o=!0)}),n=n.replace(/<li class='vakata-context-separator'><\/li>$/,""),s&&(n+="</ul>"),s||(e.html=n,t.vakata.context._trigger("parse")),n.length>10&&n},_show_submenu:function(e){if(e=t(e),!e.length||!e.children("ul").length)return;var n=e.children("ul"),a=e.offset().left,i=a+e.outerWidth(),c=e.offset().top,o=n.width(),l=n.height(),r=t(window).width()+t(window).scrollLeft(),d=t(window).height()+t(window).scrollTop();s?e[i-(o+10+e.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):e[i+o>r&&a>r-i?"addClass":"removeClass"]("vakata-context-right"),c+l+10>d&&n.css("bottom","-1px"),e.hasClass("vakata-context-right")?a<o&&n.css("margin-right",a-o):r-i<o&&n.css("margin-left",r-i-o),n.show()},show:function(o,i,l){var d,r,a,c,u,h,m,f,p=!0;switch(e.element&&e.element.length&&e.element.width(''),p){case!i&&!o:return!1;case!!i&&!!o:e.reference=o,e.position_x=i.x,e.position_y=i.y;break;case!i&&!!o:e.reference=o,d=o.offset(),e.position_x=d.left+o.outerHeight(),e.position_y=d.top;break;case!!i&&!o:e.position_x=i.x,e.position_y=i.y;break}!!o&&!l&&t(o).data("vakata_contextmenu")&&(l=t(o).data("vakata_contextmenu")),t.vakata.context._parse(l)&&e.element.html(e.html),e.items.length&&(e.element.appendTo(n.body),r=e.element,a=e.position_x,c=e.position_y,u=r.width(),h=r.height(),m=t(window).width()+t(window).scrollLeft(),f=t(window).height()+t(window).scrollTop(),s&&(a-=r.outerWidth()-t(o).outerWidth(),a<t(window).scrollLeft()+20&&(a=t(window).scrollLeft()+20)),a+u+20>m&&(a=m-(u+20)),c+h+20>f&&(c=f-(h+20)),e.element.css({left:a,top:c}).show().find("a").first().trigger("focus").parent().addClass("vakata-context-hover"),e.is_visible=!0,t.vakata.context._trigger("show"))},hide:function(){e.is_visible&&(e.element.hide().find("ul").hide().end().find(":focus").trigger("blur").end().detach(),e.is_visible=!1,t.vakata.context._trigger("hide"))}},t(function(){s=t(n.body).css("direction")==="rtl";var o=!1;e.element=t("<ul class='vakata-context'></ul>"),e.element.on("mouseenter","li",function(n){if(n.stopImmediatePropagation(),t.contains(this,n.relatedTarget))return;o&&clearTimeout(o),e.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),t(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),t.vakata.context._show_submenu(this)}).on("mouseleave","li",function(e){if(t.contains(this,e.relatedTarget))return;t(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(){t(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),t.vakata.context.settings.hide_onmouseleave&&(o=setTimeout(function(){return function(){t.vakata.context.hide()}}(this),t.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(e){e.preventDefault(),!t(this).trigger("blur").parent().hasClass("vakata-context-disabled")&&t.vakata.context._execute(t(this).attr("rel"))!==!1&&t.vakata.context.hide()}).on("keydown","a",function(n){var s=null;switch(n.which){case 13:case 32:n.type="click",n.preventDefault(),t(n.currentTarget).trigger(n);break;case 37:e.is_visible&&(e.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").trigger("focus"),n.stopImmediatePropagation(),n.preventDefault());break;case 38:e.is_visible&&(s=e.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),s.length||(s=e.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),s.addClass("vakata-context-hover").children("a").trigger("focus"),n.stopImmediatePropagation(),n.preventDefault());break;case 39:e.is_visible&&(e.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").trigger("focus"),n.stopImmediatePropagation(),n.preventDefault());break;case 40:e.is_visible&&(s=e.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),s.length||(s=e.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),s.addClass("vakata-context-hover").children("a").trigger("focus"),n.stopImmediatePropagation(),n.preventDefault());break;case 27:t.vakata.context.hide(),n.preventDefault();break;default:break}}).on("keydown",function(t){t.preventDefault();var n=e.element.find(".vakata-contextmenu-shortcut-"+t.which).parent();n.parent().not(".vakata-context-disabled")&&n.trigger("click")}),t(n).on("mousedown.vakata.jstree",function(n){e.is_visible&&e.element[0]!==n.target&&!t.contains(e.element[0],n.target)&&t.vakata.context.hide()}).on("context_show.vakata.jstree",function(){e.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),s&&e.element.addClass("vakata-context-rtl").css("direction","rtl"),e.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1},e.jstree.plugins.dnd=function(o,t){this.init=function(e,s){t.init.call(this,e,s),this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in n.createElement("span")},this.bind=function(){t.bind.call(this),this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",function(t){if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if(t.type==="touchstart"&&(!this.settings.dnd.touch||this.settings.dnd.touch==="selected"&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var n=this.get_node(t.target),o=this.is_selected(n)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,i=o>1?o+" "+this.get_string("nodes"):this.get_text(t.currentTarget);if(this.settings.core.force_text&&(i=e.vakata.html.escape(i)),n&&n.id&&n.id!==e.jstree.root&&(t.which===1||t.type==="touchstart"||t.type==="dragstart")&&(this.settings.dnd.is_draggable===!0||e.vakata.is_function(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,o>1?this.get_top_selected(!0):[n],t)))if(a={jstree:!0,origin:this,obj:this.get_node(n,!0),nodes:o>1?this.get_top_selected():[n.id]},s=t.currentTarget,this.settings.dnd.use_html5)e.vakata.dnd._trigger("start",t,{helper:e(),element:s,data:a});else return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,a,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":'')+'"><i class="jstree-icon jstree-er"></i>'+i+'<ins class="jstree-copy">+</ins></div>')}.bind(this)),this.settings.dnd.use_html5&&this.element.on("dragover.jstree",function(t){return t.preventDefault(),e.vakata.dnd._trigger("move",t,{helper:e(),element:s,data:a}),!1}).on("drop.jstree",function(t){return t.preventDefault(),e.vakata.dnd._trigger("stop",t,{helper:e(),element:s,data:a}),!1}.bind(this))},this.redraw_node=function(e){if(e=t.redraw_node.apply(this,arguments),e&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)e.setAttribute("draggable",!0);else{var n,o,s=null;for(n=0,o=e.childNodes.length;n<o;n++)if(e.childNodes[n]&&e.childNodes[n].className&&e.childNodes[n].className.indexOf("jstree-anchor")!==-1){s=e.childNodes[n];break}s&&s.setAttribute("draggable",!0)}return e}},e(function(){var o=!1,l=!1,i=!1,r=!1,c=e('<div id="jstree-marker">&#160;</div>').hide();e(n).on("dragover.vakata.jstree",function(t){s&&e.vakata.dnd._trigger("move",t,{helper:e(),element:s,data:a})}).on("drop.vakata.jstree",function(t){s&&(e.vakata.dnd._trigger("stop",t,{helper:e(),element:s,data:a}),s=null,a=null)}).on("dnd_start.vakata.jstree",function(t,e){if(o=!1,i=!1,!e||!e.data||!e.data.jstree)return;c.appendTo(n.body)}).on("dnd_move.vakata.jstree",function(F,n){if(S=n.event.target!==i.target,r&&(!n.event||n.event.type!=="dragover"||S)&&clearTimeout(r),!n||!n.data||!n.data.jstree)return;if(n.event.target.id&&n.event.target.id==="jstree-marker")return;i=n.event;var S,s=e.jstree.reference(n.event.target),a=!1,h=!1,_=!1,M,y,j,f,m,p,g,u,d,O,E,x,A,b,v,w,k,C;if(s&&s._data&&s._data.dnd)if(c.attr("class","jstree-"+s.get_theme()+(s.settings.core.themes.responsive?" jstree-dnd-responsive":'')),w=n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(n.event.metaKey||n.event.ctrlKey)),n.helper.children().attr("class","jstree-"+s.get_theme()+" jstree-"+s.get_theme()+"-"+s.get_theme_variant()+" "+(s.settings.core.themes.responsive?" jstree-dnd-responsive":'')).find(".jstree-copy").first()[w?"show":"hide"](),(n.event.target===s.element[0]||n.event.target===s.get_container_ul()[0])&&s.get_container_ul().children().length===0){{u=!0;for(d=0,O=n.data.nodes.length;d<O;d++)if(u=u&&s.check(n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(n.event.metaKey||n.event.ctrlKey))?"copy_node":"move_node",n.data.origin&&n.data.origin!==s?n.data.origin.get_node(n.data.nodes[d]):n.data.nodes[d],e.jstree.root,"last",{dnd:!0,ref:s.get_node(e.jstree.root),pos:"i",origin:n.data.origin,is_multi:n.data.origin&&n.data.origin!==s,is_foreign:!n.data.origin}),!u)break;if(u){o={ins:s,par:e.jstree.root,pos:"last"},c.hide(),n.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),n.event.originalEvent&&n.event.originalEvent.dataTransfer&&(n.event.originalEvent.dataTransfer.dropEffect=w?"copy":"move");return}}}else if(a=s.settings.dnd.large_drop_target?e(n.event.target).closest(".jstree-node").children(".jstree-anchor"):e(n.event.target).closest(".jstree-anchor"),a&&a.length&&a.parent().is(".jstree-closed, .jstree-open, .jstree-leaf"))if(h=a.offset(),_=(n.event.pageY!==t?n.event.pageY:n.event.originalEvent.pageY)-h.top,f=a.outerHeight(),_<f/3?g=["b","i","a"]:_>f-f/3?g=["a","i","b"]:g=_>f/2?["i","a","b"]:["i","b","a"],e.each(g,function(i,t){switch(t){case"b":y=h.left-6,j=h.top,m=s.get_parent(a),p=a.parent().index(),C="jstree-below";break;case"i":b=s.settings.dnd.inside_pos,v=s.get_node(a.parent()),y=h.left-2,j=h.top+f/2+1,m=v.id,p=b==="first"?0:b==="last"?v.children.length:Math.min(b,v.children.length),C="jstree-inside";break;case"a":y=h.left-6,j=h.top+f,m=s.get_parent(a),p=a.parent().index()+1,C="jstree-above";break}u=!0;for(d=0,O=n.data.nodes.length;d<O;d++)if(E=n.data.origin&&(n.data.origin.settings.dnd.always_copy||n.data.origin.settings.dnd.copy&&(n.event.metaKey||n.event.ctrlKey))?"copy_node":"move_node",x=p,E==="move_node"&&t==="a"&&n.data.origin&&n.data.origin===s&&m===s.get_parent(n.data.nodes[d])&&(A=s.get_node(m),x>e.inArray(n.data.nodes[d],A.children)&&(x-=1)),u=u&&(s&&s.settings&&s.settings.dnd&&s.settings.dnd.check_while_dragging===!1||s.check(E,n.data.origin&&n.data.origin!==s?n.data.origin.get_node(n.data.nodes[d]):n.data.nodes[d],m,x,{dnd:!0,ref:s.get_node(a.parent()),pos:t,origin:n.data.origin,is_multi:n.data.origin&&n.data.origin!==s,is_foreign:!n.data.origin})),!u){s&&s.last_error&&(l=s.last_error());break}if(t==="i"&&a.parent().is(".jstree-closed")&&s.settings.dnd.open_timeout&&(!n.event||n.event.type!=="dragover"||S)&&(r&&clearTimeout(r),r=setTimeout(function(e,t){return function(){e.open_node(t)}}(s,a),s.settings.dnd.open_timeout)),u)return k=s.get_node(m,!0),k.hasClass(".jstree-dnd-parent")||(e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),k.addClass("jstree-dnd-parent")),o={ins:s,par:m,pos:t==="i"&&b==="last"&&p===0&&!s.is_loaded(v)?"last":p},c.css({left:y+"px",top:j+"px"}).show(),c.removeClass("jstree-above jstree-inside jstree-below").addClass(C),n.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),n.event.originalEvent&&n.event.originalEvent.dataTransfer&&(n.event.originalEvent.dataTransfer.dropEffect=w?"copy":"move"),l={},g=!0,!1}),g===!0)return;e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),o=!1,n.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),n.event.originalEvent&&n.event.originalEvent.dataTransfer,c.hide()}).on("dnd_scroll.vakata.jstree",function(t,e){if(!e||!e.data||!e.data.jstree)return;c.hide(),o=!1,i=!1,e.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er")}).on("dnd_stop.vakata.jstree",function(d,t){if(e(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),r&&clearTimeout(r),!t||!t.data||!t.data.jstree)return;c.hide().detach();var n,s,a=[];if(o){for(n=0,s=t.data.nodes.length;n<s;n++)a[n]=t.data.origin?t.data.origin.get_node(t.data.nodes[n]):t.data.nodes[n];o.ins[t.data.origin&&(t.data.origin.settings.dnd.always_copy||t.data.origin.settings.dnd.copy&&(t.event.metaKey||t.event.ctrlKey))?"copy_node":"move_node"](a,o.par,o.pos,!1,!1,!1,t.data.origin)}else n=e(t.event.target).closest(".jstree"),n.length&&l&&l.error&&l.error==="check"&&(n=n.jstree(!0),n&&n.settings.core.error.call(this,l));i=!1,o=!1}).on("keyup.jstree keydown.jstree",function(n,t){t=e.vakata.dnd._get(),t&&t.data&&t.data.jstree&&(n.type==="keyup"&&n.which===27?(r&&clearTimeout(r),o=!1,l=!1,i=!1,r=!1,c.hide().detach(),e.vakata.dnd._clean()):(t.helper.find(".jstree-copy").first()[t.data.origin&&(t.data.origin.settings.dnd.always_copy||t.data.origin.settings.dnd.copy&&(n.metaKey||n.ctrlKey))?"show":"hide"](),i&&(i.metaKey=n.metaKey,i.ctrlKey=n.ctrlKey,e.vakata.dnd._trigger("move",i))))})}),function(o){o.vakata.html={div:o("<div></div>"),escape:function(e){return o.vakata.html.div.text(e).html()},strip:function(e){return o.vakata.html.div.empty().append(o.parseHTML(e)).text()}};var e={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};o.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:10},_trigger:function(s,i,e){e===t&&(e=o.vakata.dnd._get()),e.event=i,o(n).triggerHandler("dnd_"+s+".vakata",e)},_get:function(){return{data:e.data,element:e.element,helper:e.helper}},_clean:function(){e.helper&&e.helper.remove(),e.scroll_i&&(clearInterval(e.scroll_i),e.scroll_i=!1),e={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},s=null,o(n).off("mousemove.vakata.jstree touchmove.vakata.jstree",o.vakata.dnd.drag),o(n).off("mouseup.vakata.jstree touchend.vakata.jstree",o.vakata.dnd.stop)},_scroll:function(s){if(!e.scroll_e||!e.scroll_l&&!e.scroll_t)return e.scroll_i&&(clearInterval(e.scroll_i),e.scroll_i=!1),!1;if(!e.scroll_i)return e.scroll_i=setInterval(o.vakata.dnd._scroll,100),!1;if(s===!0)return!1;var t=e.scroll_e.scrollTop(),n=e.scroll_e.scrollLeft();e.scroll_e.scrollTop(t+e.scroll_t*o.vakata.dnd.settings.scroll_speed),e.scroll_e.scrollLeft(n+e.scroll_l*o.vakata.dnd.settings.scroll_speed),(t!==e.scroll_e.scrollTop()||n!==e.scroll_e.scrollLeft())&&o.vakata.dnd._trigger("scroll",e.scroll_e)},start:function(t,i,s){t.type==="touchstart"&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=n.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),e.is_drag&&o.vakata.dnd.stop({});try{t.currentTarget.unselectable="on",t.currentTarget.onselectstart=function(){return!1},t.currentTarget.style&&(t.currentTarget.style.touchAction="none",t.currentTarget.style.msTouchAction="none",t.currentTarget.style.MozUserSelect="none")}catch(e){}return e.init_x=t.pageX,e.init_y=t.pageY,e.data=i,e.is_down=!0,e.element=t.currentTarget,e.target=t.target,e.is_touch=t.type==="touchstart",s!==!1&&(e.helper=o("<div id='vakata-dnd'></div>").html(s).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),o(n).on("mousemove.vakata.jstree touchmove.vakata.jstree",o.vakata.dnd.drag),o(n).on("mouseup.vakata.jstree touchend.vakata.jstree",o.vakata.dnd.stop),!1},drag:function(t){if(t.type==="touchmove"&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=n.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),!e.is_down)return;if(!e.is_drag)if(Math.abs(t.pageX-e.init_x)>(e.is_touch?o.vakata.dnd.settings.threshold_touch:o.vakata.dnd.settings.threshold)||Math.abs(t.pageY-e.init_y)>(e.is_touch?o.vakata.dnd.settings.threshold_touch:o.vakata.dnd.settings.threshold))e.helper&&(e.helper.appendTo(n.body),e.helper_w=e.helper.outerWidth()),e.is_drag=!0,o(e.target).one("click.vakata",!1),o.vakata.dnd._trigger("start",t);else return;var s=!1,u=!1,i=!1,r=!1,a=!1,c=!1,h=!1,m=!1,l=!1,d=!1;return e.scroll_t=0,e.scroll_l=0,e.scroll_e=!1,o(o(t.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(o(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var s=o(this),n=s.offset();if(this.scrollHeight>this.offsetHeight&&(n.top+s.height()-t.pageY<o.vakata.dnd.settings.scroll_proximity&&(e.scroll_t=1),t.pageY-n.top<o.vakata.dnd.settings.scroll_proximity&&(e.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(n.left+s.width()-t.pageX<o.vakata.dnd.settings.scroll_proximity&&(e.scroll_l=1),t.pageX-n.left<o.vakata.dnd.settings.scroll_proximity&&(e.scroll_l=-1)),e.scroll_t||e.scroll_l)return e.scroll_e=o(this),!1}),e.scroll_e||(s=o(n),u=o(window),i=s.height(),r=u.height(),a=s.width(),c=u.width(),h=s.scrollTop(),m=s.scrollLeft(),i>r&&t.pageY-h<o.vakata.dnd.settings.scroll_proximity&&(e.scroll_t=-1),i>r&&r-(t.pageY-h)<o.vakata.dnd.settings.scroll_proximity&&(e.scroll_t=1),a>c&&t.pageX-m<o.vakata.dnd.settings.scroll_proximity&&(e.scroll_l=-1),a>c&&c-(t.pageX-m)<o.vakata.dnd.settings.scroll_proximity&&(e.scroll_l=1),(e.scroll_t||e.scroll_l)&&(e.scroll_e=s)),e.scroll_e&&o.vakata.dnd._scroll(!0),e.helper&&(l=parseInt(t.pageY+o.vakata.dnd.settings.helper_top,10),d=parseInt(t.pageX+o.vakata.dnd.settings.helper_left,10),i&&l+25>i&&(l=i-50),a&&d+e.helper_w>a&&(d=a-(e.helper_w+2)),e.helper.css({left:d+"px",top:l+"px"})),o.vakata.dnd._trigger("move",t),!1},stop:function(t){if(t.type==="touchend"&&t.originalEvent&&t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t.target=n.elementFromPoint(t.originalEvent.changedTouches[0].pageX-window.pageXOffset,t.originalEvent.changedTouches[0].pageY-window.pageYOffset)),e.is_drag)t.target!==e.target&&o(e.target).off("click.vakata"),o.vakata.dnd._trigger("stop",t);else if(t.type==="touchend"&&t.target===e.target){var s=setTimeout(function(){o(t.target).trigger("click")},100);o(t.target).one("click",function(){s&&clearTimeout(s)})}return o.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(n,t){this.init=function(e,n){this._data.massload={},t.init.call(this,e,n)},this._load_nodes=function(n,l,a,c){var s=this.settings.massload,r=[],d=this._model.data,i,u,o;if(!a){for(i=0,u=n.length;i<u;i++)(!d[n[i]]||!d[n[i]].state.loaded&&!d[n[i]].state.failed||c)&&(r.push(n[i]),o=this.get_node(n[i],!0),o&&o.length&&o.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},r.length){if(e.vakata.is_function(s))return s.call(this,r,function(s){var e,i;if(s)for(e in s)s.hasOwnProperty(e)&&(this._data.massload[e]=s[e]);for(e=0,i=n.length;e<i;e++)o=this.get_node(n[e],!0),o&&o.length&&o.removeClass("jstree-loading").attr("aria-busy",!1);t._load_nodes.call(this,n,l,a,c)}.bind(this));if(typeof s=="object"&&s&&s.url)return s=e.extend(!0,{},s),e.vakata.is_function(s.url)&&(s.url=s.url.call(this,r)),e.vakata.is_function(s.data)&&(s.data=s.data.call(this,r)),e.ajax(s).done(function(s){var e,i;if(s)for(e in s)s.hasOwnProperty(e)&&(this._data.massload[e]=s[e]);for(e=0,i=n.length;e<i;e++)o=this.get_node(n[e],!0),o&&o.length&&o.removeClass("jstree-loading").attr("aria-busy",!1);t._load_nodes.call(this,n,l,a,c)}.bind(this)).fail(function(){t._load_nodes.call(this,n,l,a,c)}.bind(this))}}return t._load_nodes.call(this,n,l,a,c)},this._load_node=function(n,i){var s=this._data.massload[n.id],a=null,o;return s?(a=this[typeof s=="string"?"_append_html_data":"_append_json_data"](n,typeof s=="string"?e(e.parseHTML(s)).filter(function(){return this.nodeType!==3}):s,function(e){i.call(this,e)}),o=this.get_node(n.id,!0),o&&o.length&&o.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[n.id],a):t._load_node.call(this,n,i)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(s,n){this.bind=function(){n.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this._data.search.hdn=[],this.element.on("search.jstree",function(c,n){if(this._data.search.som&&n.res.length){var s=this._model.data,t,a,o=[],i,r;for(t=0,a=n.res.length;t<a;t++)if(s[n.res[t]]&&!s[n.res[t]].state.hidden)if(o.push(n.res[t]),o=o.concat(s[n.res[t]].parents),this._data.search.smc)for(i=0,r=s[n.res[t]].children_d.length;i<r;i++)s[s[n.res[t]].children_d[i]]&&!s[s[n.res[t]].children_d[i]].state.hidden&&o.push(s[n.res[t]].children_d[i]);o=e.vakata.array_remove_item(e.vakata.array_unique(o),e.jstree.root),this._data.search.hdn=this.hide_all(!0),this.show_node(o,!0),this.redraw(!0)}}.bind(this)).on("clear_search.jstree",function(t,e){this._data.search.som&&e.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))}.bind(this))},this.search=function(s,p,c,n,d,u){if(s===!1||e.vakata.trim(s.toString())==="")return this.clear_search();n=this.get_node(n),n=n&&n.id?n.id:null,s=s.toString();var i=this.settings.search,o=!!i.ajax&&i.ajax,h=this._model.data,f=null,l=[],a=[],r,m;if(this._data.search.res.length&&!d&&this.clear_search(),c===t&&(c=i.show_only_matches),u===t&&(u=i.show_only_matches_children),!p&&o!==!1)return e.vakata.is_function(o)?o.call(this,s,function(t){t&&t.d&&(t=t.d),this._load_nodes(e.vakata.is_array(t)?e.vakata.array_unique(t):[],function(){this.search(s,!0,c,n,d,u)})}.bind(this),n):(o=e.extend({},o),o.data||(o.data={}),o.data.str=s,n&&(o.data.inside=n),this._data.search.lastRequest&&this._data.search.lastRequest.abort(),this._data.search.lastRequest=e.ajax(o).fail(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(o)},this.settings.core.error.call(this,this._data.core.last_error)}.bind(this)).done(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.vakata.is_array(t)?e.vakata.array_unique(t):[],function(){this.search(s,!0,c,n,d,u)})}.bind(this)),this._data.search.lastRequest);if(d||(this._data.search.str=s,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=c,this._data.search.smc=u),f=new e.vakata.search(s,!0,{caseSensitive:i.case_sensitive,fuzzy:i.fuzzy}),e.each(h[n||e.jstree.root].children_d,function(n,t){var e=h[t];e.text&&!e.state.hidden&&(!i.search_leaves_only||e.state.loaded&&e.children.length===0)&&(i.search_callback&&i.search_callback.call(this,s,e)||!i.search_callback&&f.search(e.text).isMatch)&&(l.push(t),a=a.concat(e.parents))}),l.length){a=e.vakata.array_unique(a);for(r=0,m=a.length;r<m;r++)a[r]!==e.jstree.root&&h[a[r]]&&this.open_node(a[r],null,0)===!0&&this._data.search.opn.push(a[r]);d?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(l,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(l))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(l,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=l),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:s,res:this._data.search.res,show_only_matches:c})},this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.res.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(this._data.search.res,function(t){return"0123456789".indexOf(t[0])!==-1?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search")),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this.redraw_node=function(t){if(t=n.redraw_node.apply(this,arguments),t)if(e.inArray(t.id,this._data.search.res)!==-1){var s,i,o=null;for(s=0,i=t.childNodes.length;s<i;s++)if(t.childNodes[s]&&t.childNodes[s].className&&t.childNodes[s].className.indexOf("jstree-anchor")!==-1){o=t.childNodes[s];break}o&&(o.className+=" jstree-search")}return t}},function(e){e.vakata.search=function(n,r,t){t=t||{},t=e.extend({},e.vakata.search.defaults,t),t.fuzzy!==!1&&(t.fuzzy=!0),n=t.caseSensitive?n:n.toLowerCase();var o=t.location,d=t.distance,u=t.threshold,s=n.length,c,l,i,a;return s>32&&(t.fuzzy=!1),t.fuzzy&&(c=1<<s-1,l=function(){var t={},e=0;for(e=0;e<s;e++)t[n.charAt(e)]=0;for(e=0;e<s;e++)t[n.charAt(e)]|=1<<s-e-1;return t}(),i=function(n,i){var e=n/s,t=Math.abs(o-i);return d?e+t/d:t?1:e}),a=function(r){if(r=t.caseSensitive?r:r.toLowerCase(),n===r||r.indexOf(n)!==-1)return{isMatch:!0,score:0};if(!t.fuzzy)return{isMatch:!1,score:1};var f,e,w=r.length,m=u,a=r.indexOf(n,o),p,d,g=s+w,v,y,j,h,_,b=1,O=[];a!==-1&&(m=Math.min(i(0,a),m),a=r.lastIndexOf(n,o+s),a!==-1&&(m=Math.min(i(0,a),m))),a=-1;for(f=0;f<s;f++){for(p=0,d=g;p<d;)i(f,o+d)<=m?p=d:g=d,d=Math.floor((g-p)/2+p);g=d,y=Math.max(1,o-d+1),j=Math.min(o+d,w)+s,h=new Array(j+2),h[j+1]=(1<<f)-1;for(e=j;e>=y;e--)if(_=l[r.charAt(e-1)],f===0?h[e]=(h[e+1]<<1|1)&_:h[e]=(h[e+1]<<1|1)&_|((v[e+1]|v[e])<<1|1)|v[e+1],h[e]&c)if(b=i(f,e-1),b<=m)if(m=b,a=e-1,O.push(a),a>o)y=Math.max(1,2*o-a);else break;if(i(f+1,o)>m)break;v=h}return{isMatch:a>=0,score:b}},r===!0?{search:a}:a(r)},e.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,e){this.bind=function(){e.bind.call(this),this.element.on("model.jstree",function(t,e){this.sort(e.parent,!0)}.bind(this)).on("rename_node.jstree create_node.jstree",function(t,e){this.sort(e.parent||e.node.parent,!1),this.redraw_node(e.parent||e.node.parent,!0)}.bind(this)).on("move_node.jstree copy_node.jstree",function(t,e){this.sort(e.parent,!1),this.redraw_node(e.parent,!0)}.bind(this))},this.sort=function(e,s){var t,n;if(e=this.get_node(e),e&&e.children&&e.children.length)if(e.children.sort(this.settings.sort.bind(this)),s)for(t=0,n=e.children_d.length;t<n;t++)this.sort(e.children_d[t],!1)}},h=!1,e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1,preserve_loaded:!1},e.jstree.plugins.state=function(n,t){this.bind=function(){t.bind.call(this);var e=function(){this.element.on(this.settings.state.events,function(){h&&clearTimeout(h),h=setTimeout(function(){this.save_state()}.bind(this),100)}.bind(this)),this.trigger("state_ready")}.bind(this);this.element.on("ready.jstree",function(){this.element.one("restore_state.jstree",e),this.restore_state()||e()}.bind(this))},this.save_state=function(){var t=this.get_state(),n;this.settings.state.preserve_loaded||delete t.core.loaded,n={state:t,ttl:this.settings.state.ttl,sec:+new Date},e.vakata.storage.set(this.settings.state.key,JSON.stringify(n))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(!!t)try{t=JSON.parse(t)}catch(e){return!1}return!(!!t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(!!(!!t&&t.state&&(t=t.state),!!t&&e.vakata.is_function(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t)&&(this.settings.state.preserve_loaded||delete t.core.loaded,this.element.one("set_state.jstree",function(s,n){n.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={default:{}},e.jstree.defaults.types[e.jstree.root]={},e.jstree.plugins.types=function(s,n){this.init=function(a,s){var o,i;if(s&&s.types&&s.types.default)for(o in s.types)if(o!=="default"&&o!==e.jstree.root&&s.types.hasOwnProperty(o))for(i in s.types.default)s.types.default.hasOwnProperty(i)&&s.types[o][i]===t&&(s.types[o][i]=s.types.default[i]);n.init.call(this,a,s),this._model.data[e.jstree.root].type=e.jstree.root},this.refresh=function(t,s){n.refresh.call(this,t,s),this._model.data[e.jstree.root].type=e.jstree.root},this.bind=function(){this.element.on("model.jstree",function(d,l){var s=this._model.data,o=l.nodes,a=this.settings.types,n,c,i="default",r;for(n=0,c=o.length;n<c;n++){if(i="default",s[o[n]].original&&s[o[n]].original.type&&a[s[o[n]].original.type]&&(i=s[o[n]].original.type),s[o[n]].data&&s[o[n]].data.jstree&&s[o[n]].data.jstree.type&&a[s[o[n]].data.jstree.type]&&(i=s[o[n]].data.jstree.type),s[o[n]].type=i,s[o[n]].icon===!0&&a[i].icon!==t&&(s[o[n]].icon=a[i].icon),a[i].li_attr!==t&&typeof a[i].li_attr=="object")for(r in a[i].li_attr)if(a[i].li_attr.hasOwnProperty(r)){if(r==="id")continue;s[o[n]].li_attr[r]===t?s[o[n]].li_attr[r]=a[i].li_attr[r]:r==="class"&&(s[o[n]].li_attr.class=a[i].li_attr.class+" "+s[o[n]].li_attr.class)}if(a[i].a_attr!==t&&typeof a[i].a_attr=="object")for(r in a[i].a_attr)if(a[i].a_attr.hasOwnProperty(r)){if(r==="id")continue;s[o[n]].a_attr[r]===t?s[o[n]].a_attr[r]=a[i].a_attr[r]:r==="href"&&s[o[n]].a_attr[r]==="#"?s[o[n]].a_attr.href=a[i].a_attr.href:r==="class"&&(s[o[n]].a_attr.class=a[i].a_attr.class+" "+s[o[n]].a_attr.class)}}s[e.jstree.root].type=e.jstree.root}.bind(this)),n.bind.call(this)},this.get_json=function(r,i,c){var s,a,o=this._model.data,l=i?e.extend(!0,{},i,{no_id:!1}):{},t=n.get_json.call(this,r,l,c);if(t===!1)return!1;if(e.vakata.is_array(t)){for(s=0,a=t.length;s<a;s++)t[s].type=t[s].id&&o[t[s].id]&&o[t[s].id].type?o[t[s].id].type:"default",i&&i.no_id&&(delete t[s].id,t[s].li_attr&&t[s].li_attr.id&&delete t[s].li_attr.id,t[s].a_attr&&t[s].a_attr.id&&delete t[s].a_attr.id)}else t.type=t.id&&o[t.id]&&o[t.id].type?o[t.id].type:"default",i&&i.no_id&&(t=this._delete_ids(t));return t},this._delete_ids=function(t){if(e.vakata.is_array(t)){for(var n=0,s=t.length;n<s;n++)t[n]=this._delete_ids(t[n]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.vakata.is_array(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(r,s,o,l,d){if(n.check.call(this,r,s,o,l,d)===!1)return!1;s=s&&s.id?s:this.get_node(s),o=o&&o.id?o:this.get_node(o);var c=s&&s.id?d&&d.origin?d.origin:e.jstree.reference(s.id):null,i,a,u,h;switch(c=c&&c._model&&c._model.data?c._model.data:null,r){case"create_node":case"move_node":case"copy_node":if(r!=="move_node"||e.inArray(s.id,o.children)===-1){if(i=this.get_rules(o),i.max_children!==t&&i.max_children!==-1&&i.max_children===o.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+r,data:JSON.stringify({chk:r,pos:l,obj:!!(s&&s.id)&&s.id,par:!!(o&&o.id)&&o.id})},!1;if(i.valid_children!==t&&i.valid_children!==-1&&e.inArray(s.type||"default",i.valid_children)===-1)return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+r,data:JSON.stringify({chk:r,pos:l,obj:!!(s&&s.id)&&s.id,par:!!(o&&o.id)&&o.id})},!1;if(c&&s.children_d&&s.parents){a=0;for(u=0,h=s.children_d.length;u<h;u++)a=Math.max(a,c[s.children_d[u]].parents.length);a=a-s.parents.length+1}(a<=0||a===t)&&(a=1);do{if(i.max_depth!==t&&i.max_depth!==-1&&i.max_depth<a)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+r,data:JSON.stringify({chk:r,pos:l,obj:!!(s&&s.id)&&s.id,par:!!(o&&o.id)&&o.id})},!1;o=this.get_node(o.parent),i=this.get_rules(o),a++}while(o)}break}return!0},this.get_rules=function(n){if(n=this.get_node(n),!n)return!1;var e=this.get_type(n,!0);return e.max_depth===t&&(e.max_depth=-1),e.max_children===t&&(e.max_children=-1),e.valid_children===t&&(e.valid_children=-1),e},this.get_type=function(t,n){return t=this.get_node(t),!!t&&(n?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(o,i){var r=this._model.data,s,d,h,a,u,n,l,c;if(e.vakata.is_array(o)){o=o.slice();for(d=0,h=o.length;d<h;d++)this.set_type(o[d],i);return!0}if(s=this.settings.types,o=this.get_node(o),!s[i]||!o)return!1;if(l=this.get_node(o,!0),l&&l.length&&(c=l.children(".jstree-anchor")),a=o.type,u=this.get_icon(o),o.type=i,(u===!0||!s[a]||s[a].icon!==t&&u===s[a].icon)&&this.set_icon(o,s[i].icon===t||s[i].icon),s[a]&&s[a].li_attr!==t&&typeof s[a].li_attr=="object")for(n in s[a].li_attr)if(s[a].li_attr.hasOwnProperty(n)){if(n==="id")continue;n==="class"?(r[o.id].li_attr.class=(r[o.id].li_attr.class||'').replace(s[a].li_attr[n],''),l&&l.removeClass(s[a].li_attr[n])):r[o.id].li_attr[n]===s[a].li_attr[n]&&(r[o.id].li_attr[n]=null,l&&l.removeAttr(n))}if(s[a]&&s[a].a_attr!==t&&typeof s[a].a_attr=="object")for(n in s[a].a_attr)if(s[a].a_attr.hasOwnProperty(n)){if(n==="id")continue;n==="class"?(r[o.id].a_attr.class=(r[o.id].a_attr.class||'').replace(s[a].a_attr[n],''),c&&c.removeClass(s[a].a_attr[n])):r[o.id].a_attr[n]===s[a].a_attr[n]&&(n==="href"?(r[o.id].a_attr[n]="#",c&&c.attr("href","#")):(delete r[o.id].a_attr[n],c&&c.removeAttr(n)))}if(s[i].li_attr!==t&&typeof s[i].li_attr=="object")for(n in s[i].li_attr)if(s[i].li_attr.hasOwnProperty(n)){if(n==="id")continue;r[o.id].li_attr[n]===t?(r[o.id].li_attr[n]=s[i].li_attr[n],l&&(n==="class"?l.addClass(s[i].li_attr[n]):l.attr(n,s[i].li_attr[n]))):n==="class"&&(r[o.id].li_attr.class=s[i].li_attr[n]+" "+r[o.id].li_attr.class,l&&l.addClass(s[i].li_attr[n]))}if(s[i].a_attr!==t&&typeof s[i].a_attr=="object")for(n in s[i].a_attr)if(s[i].a_attr.hasOwnProperty(n)){if(n==="id")continue;r[o.id].a_attr[n]===t?(r[o.id].a_attr[n]=s[i].a_attr[n],c&&(n==="class"?c.addClass(s[i].a_attr[n]):c.attr(n,s[i].a_attr[n]))):n==="href"&&r[o.id].a_attr[n]==="#"?(r[o.id].a_attr.href=s[i].a_attr.href,c&&c.attr("href",s[i].a_attr.href)):n==="class"&&(r[o.id].a_attr.class=s[i].a_attr.class+" "+r[o.id].a_attr.class,c&&c.addClass(s[i].a_attr[n]))}return!0}},e.jstree.defaults.unique={case_sensitive:!1,trim_whitespace:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(s,n){this.check=function(r,s,t,c,h){if(n.check.call(this,r,s,t,c,h)===!1)return!1;if(s=s&&s.id?s:this.get_node(s),t=t&&t.id?t:this.get_node(t),!t||!t.children)return!0;var i=r==="rename_node"?c:s.text,l=[],d=this.settings.unique.case_sensitive,u=this.settings.unique.trim_whitespace,f=this._model.data,o,m,a;for(o=0,m=t.children.length;o<m;o++)a=f[t.children[o]].text,d||(a=a.toLowerCase()),u&&(a=a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,'')),l.push(a);switch(d||(i=i.toLowerCase()),u&&(i=i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,'')),r){case"delete_node":return!0;case"rename_node":return a=s.text||'',d||(a=a.toLowerCase()),u&&(a=a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,'')),o=e.inArray(i,l)===-1||s.text&&a===i,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+i+" already exists. Preventing: "+r,data:JSON.stringify({chk:r,pos:c,obj:!!(s&&s.id)&&s.id,par:!!(t&&t.id)&&t.id})}),o;case"create_node":return o=e.inArray(i,l)===-1,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+i+" already exists. Preventing: "+r,data:JSON.stringify({chk:r,pos:c,obj:!!(s&&s.id)&&s.id,par:!!(t&&t.id)&&t.id})}),o;case"copy_node":return o=e.inArray(i,l)===-1,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+i+" already exists. Preventing: "+r,data:JSON.stringify({chk:r,pos:c,obj:!!(s&&s.id)&&s.id,par:!!(t&&t.id)&&t.id})}),o;case"move_node":return o=s.parent===t.id&&(!h||!h.is_multi)||e.inArray(i,l)===-1,o||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+i+" already exists. Preventing: "+r,data:JSON.stringify({chk:r,pos:c,obj:!!(s&&s.id)&&s.id,par:!!(t&&t.id)&&t.id})}),o}return!0},this.create_node=function(o,i,a,u,l){if(!i||i.text===t){if(o===null&&(o=e.jstree.root),o=this.get_node(o),!o)return n.create_node.call(this,o,i,a,u,l);if(a=a===t?"last":a,!a.toString().match(/^(before|after)$/)&&!l&&!this.is_loaded(o))return n.create_node.call(this,o,i,a,u,l);i||(i={});var p,r,f,g=this._model.data,d=this.settings.unique.case_sensitive,h=this.settings.unique.trim_whitespace,v=this.settings.unique.duplicate,s,c=p=this.get_string("New node"),m=[];for(r=0,f=o.children.length;r<f;r++)s=g[o.children[r]].text,d||(s=s.toLowerCase()),h&&(s=s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,'')),m.push(s);for(r=1,s=c,d||(s=s.toLowerCase()),h&&(s=s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,''));e.inArray(s,m)!==-1;)c=v.call(this,p,++r).toString(),s=c,d||(s=s.toLowerCase()),h&&(s=s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,''));i.text=c}return n.create_node.call(this,o,i,a,u,l)}},c=n.createElement("DIV"),c.setAttribute("unselectable","on"),c.setAttribute("role","presentation"),c.className="jstree-wholerow",c.innerHTML="&#160;",e.jstree.plugins.wholerow=function(n,t){this.bind=function(){t.bind.call(this),this.element.on("ready.jstree set_state.jstree",function(){this.hide_dots()}.bind(this)).on("init.jstree loading.jstree ready.jstree",function(){this.get_container_ul().addClass("jstree-wholerow-ul")}.bind(this)).on("deselect_all.jstree",function(){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")}.bind(this)).on("changed.jstree",function(o,n){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var e=!1,t,s;for(t=0,s=n.selected.length;t<s;t++)e=this.get_node(n.selected[t],!0),e&&e.length&&e.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}.bind(this)).on("open_node.jstree",function(t,e){this.get_node(e.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")}.bind(this)).on("hover_node.jstree dehover_node.jstree",function(e,t){if(e.type==="hover_node"&&this.is_disabled(t.node))return;this.get_node(t.node,!0).children(".jstree-wholerow")[e.type==="hover_node"?"addClass":"removeClass"]("jstree-wholerow-hovered")}.bind(this)).on("contextmenu.jstree",".jstree-wholerow",function(t){if(this._data.contextmenu){t.preventDefault();var n=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(n)}}.bind(this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var n=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(n).trigger("focus")}).on("dblclick.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var n=e.Event("dblclick",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(n).trigger("focus")}).on("click.jstree",".jstree-leaf > .jstree-ocl",function(t){t.stopImmediatePropagation();var n=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(n).trigger("focus")}.bind(this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1}.bind(this)).on("mouseleave.jstree",".jstree-node",function(e){this.dehover_node(e.currentTarget)}.bind(this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),t.teardown.call(this)},this.redraw_node=function(n){if(n=t.redraw_node.apply(this,arguments),n){var s=c.cloneNode(!0);e.inArray(n.id,this._data.core.selected)!==-1&&(s.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===n.id&&(s.className+=" jstree-wholerow-hovered"),n.insertBefore(s,n.childNodes[0])}return n}},window.customElements&&Object&&Object.create){p=Object.create(HTMLElement.prototype),p.createdCallback=function(){var n={core:{},plugins:[]},t;for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(n.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(n[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(n.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(n)};try{window.customElements.define("vakata-jstree",function(){},{prototype:p})}catch(e){}}})